# Phase 31 UI 組件測試指南

## 📋 概述

Phase 31 新增了 4 個結構化 UI 組件，用於呈現教學品質分析報告。本指南說明如何在真實環境中測試這些組件。

---

## 🚀 本機測試流程

### 1. 確保環境變數已設定

在專案根目錄建立 `.env` 檔案（如果尚未建立）：

```bash
# .env
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
SUPABASE_DB_URL=postgresql://postgres:[password]@[host]:[port]/postgres
GOOGLE_SHEETS_CREDENTIALS={"client_email":"...","private_key":"..."}
PORT=5000
NODE_ENV=development
```

### 2. 安裝依賴（首次執行或更新後）

```bash
npm install
```

### 3. 啟動本機開發伺服器

```bash
npm run dev
# 或
npm run dev:clean  # 如果需要清理舊進程
```

### 4. 訪問測試頁面

打開瀏覽器訪問：
```
http://localhost:5000/teaching-quality/fb1dbdd0-283b-4a04-b8fd-b3e944375660
```

---

## 🔄 部署到生產環境（Zeabur）

### 1. 本機測試通過後，推送到 GitHub

```bash
git add -A
git commit -m "feat: your commit message"
git push origin main
```

### 2. Zeabur 自動部署

- Zeabur 會自動偵測 GitHub 的 push 事件
- 自動觸發建置和部署
- 部署完成後可在 Zeabur 儀表板查看狀態

---

## 🧪 測試新的 UI 組件

### 測試環境準備

1. **確保有測試資料**
   - 陳冠霖的分析報告已在 Phase 30.5 重新生成
   - Analysis ID: `fb1dbdd0-283b-4a04-b8fd-b3e944375660`

2. **訪問測試頁面**
   - 本機: `http://localhost:5000/teaching-quality/fb1dbdd0-283b-4a04-b8fd-b3e944375660`
   - 生產: `https://your-zeabur-domain/teaching-quality/fb1dbdd0-283b-4a04-b8fd-b3e944375660`

---

## ✅ 測試檢查清單

### 1. PainPointsSection 組件

**預期顯示**：
- [ ] 5 層次痛點卡片（目標/社交/情緒/環境/技術）
- [ ] 每層使用不同顏色（紫/藍/紅/綠/灰）
- [ ] 顯示「已探索：X/5 層」badge
- [ ] 每個痛點包含：
  - [ ] 內心痛點描述
  - [ ] 行為證據（含時間戳）
  - [ ] 一對一教練價值說明
  - [ ] 4 個價值 badge（隨時隨地/即時解惑/確保做對/提升頻率）
- [ ] 展開/收合按鈕正常運作
- [ ] 重要提醒區塊顯示正確

**測試步驟**：
1. 滾動至「深層痛點分析（5 層次架構）」section
2. 檢查是否所有 5 層都顯示
3. 點擊展開/收合按鈕測試互動
4. 點擊時間戳（例如 14:08:48）
5. 確認頁面跳轉至逐字稿區域並高亮對應行

---

### 2. TeachingScoresSection 組件

**預期顯示**：
- [ ] 5 個指標卡片（橫式網格佈局）
- [ ] 每個卡片包含：
  - [ ] 指標名稱 + icon
  - [ ] 分數（X/5）
  - [ ] 進度條
  - [ ] 評級標籤（優秀/良好/尚可/需改進/急需改進）
  - [ ] 證據說明
- [ ] 總分進度條（20/25）
- [ ] 評級說明 badges（5 種顏色）
- [ ] 總評說明區塊

**測試步驟**：
1. 滾動至「成交策略評估（5 大指標）」section
2. 檢查 5 個指標分數：
   - 呼應痛點程度：4/5
   - 推課引導力度：4/5
   - Double Bind / NLP 應用：2/5
   - 情緒共鳴與信任：5/5
   - 節奏與收斂完整度：5/5
3. 確認總分顯示：20/25（80%）
4. 檢查總評說明是否顯示

---

### 3. ConversionProbabilitySection 組件

**預期顯示**：
- [ ] 圓形儀表板（75%）
- [ ] 進度條
- [ ] 機率等級 badge（高）
- [ ] 計算公式拆解：
  - [ ] 基礎分：40%
  - [ ] 加分項（✅ 已達成）
  - [ ] 減分項（如有）
  - [ ] 尚未達成項目（⚠️）
- [ ] AI 推理說明（Markdown 格式）

**測試步驟**：
1. 滾動至「預估成交機率（量化指標計算）」section
2. 確認儀表板顯示 75%
3. 檢查計算公式是否正確展開：
   - 基礎分：40%
   - ✅ 已購課/已付訂金：+20%
   - ✅ 課後主動約下次上課時間：+15%
   - ❌ 課程中積極提問（5次以上）：+10%（未達成）
4. 確認 AI 推理說明顯示正確

---

### 4. SalesScriptsSection 組件

**預期顯示**：
- [ ] 推課方向重要提醒（橘色）
- [ ] 3 個版本 Tabs（A/B/C）
- [ ] 每個 Tab 顯示：
  - [ ] 版本標題
  - [ ] NLP 技巧標籤
- [ ] 點擊 Tab 切換話術內容
- [ ] 每個版本包含：
  - [ ] 目標受眾描述
  - [ ] NLP 技巧 badge
  - [ ] 完整話術內容（Markdown 格式）
  - [ ] 複製按鈕
  - [ ] 使用指引
- [ ] 「複製全部話術」按鈕
- [ ] 個人化要求說明（綠色）

**測試步驟**：
1. 滾動至「完整成交話術總結（可照念）」section
2. 點擊每個 Tab（版本 A/B/C）確認切換正常
3. 點擊「複製」按鈕，確認顯示「已複製」
4. 點擊「複製全部話術」，檢查剪貼簿內容
5. 確認話術內容格式正確（有段落、粗體、引言等）

---

## 🔍 常見問題排查

### 問題 1: 新組件沒有顯示

**可能原因**：
- Markdown 解析失敗
- `newParsedAnalysis` 為 null

**檢查方法**：
1. 打開瀏覽器開發者工具（F12）
2. 查看 Console 是否有錯誤訊息
3. 檢查 Network tab，確認 API 回傳的 Markdown 格式正確

**解決方法**：
- 如果解析失敗，會顯示舊的 UI（fallback 機制）
- 檢查 `parseTeachingAnalysisMarkdown()` 函數的錯誤處理

---

### 問題 2: 時間戳點擊無反應

**可能原因**：
- `handleTimestampClick` 函數未正確傳遞
- 逐字稿區域未展開

**解決方法**：
1. 確認 `onTimestampClick` prop 已傳遞給所有組件
2. 點擊時間戳前，先手動展開逐字稿區域
3. 檢查 Console 是否有錯誤

---

### 問題 3: 解析器提取資料不完整

**可能原因**：
- Markdown 格式與預期不符
- GPT 生成的報告格式改變

**檢查方法**：
1. 在瀏覽器開發者工具執行：
   ```javascript
   console.log(analysis.conversion_suggestions.markdownOutput)
   ```
2. 檢查實際的 Markdown 格式
3. 與 `parseTeachingAnalysisMarkdown()` 的正則表達式對比

**解決方法**：
- 修改解析器的正則表達式
- 增加容錯處理
- 使用測試腳本 `test-phase31-parser.ts` 驗證

---

## 📊 性能測試

### 渲染性能

1. 打開 Chrome DevTools → Performance
2. 點擊「Record」
3. 載入教學品質詳細頁面
4. 停止錄製
5. 檢查：
   - [ ] 頁面載入時間 < 3 秒
   - [ ] 組件渲染時間 < 500ms
   - [ ] 無明顯的重複渲染

### 記憶體使用

1. 打開 Chrome DevTools → Memory
2. 拍攝 Heap snapshot
3. 檢查：
   - [ ] 總記憶體使用 < 50MB
   - [ ] 無明顯的記憶體洩漏

---

## 🎯 用戶驗收測試

### 測試情境 1: 老師查看學員分析報告

**步驟**：
1. 以老師身份登入
2. 進入「教學品質」頁面
3. 點擊任一學員的分析報告
4. 瀏覽所有新的 UI 組件

**預期結果**：
- 所有組件正確顯示
- 視覺效果符合設計
- 互動功能正常運作

---

### 測試情境 2: 使用推課話術

**步驟**：
1. 滾動至「完整成交話術總結」
2. 根據學員類型選擇適合的版本（A/B/C）
3. 點擊「複製」按鈕
4. 將話術貼至其他應用（如 Line、Email）

**預期結果**：
- 話術格式保持正確
- 無亂碼或格式問題
- 個人化內容符合學員情況

---

### 測試情境 3: 追蹤痛點證據

**步驟**：
1. 查看「深層痛點分析」
2. 點擊任一時間戳（例如 14:08:48）
3. 確認跳轉至逐字稿區域
4. 查看對應的對話內容

**預期結果**：
- 頁面平滑滾動至逐字稿
- 對應行高亮顯示 3 秒
- 時間戳與對話內容吻合

---

## 📝 測試報告模板

```markdown
# Phase 31 UI 組件測試報告

**測試日期**: YYYY-MM-DD
**測試人員**: XXX
**測試環境**: Replit Production

## 測試結果

### PainPointsSection
- [ ] 通過
- [ ] 失敗
- 問題描述: ___________

### TeachingScoresSection
- [ ] 通過
- [ ] 失敗
- 問題描述: ___________

### ConversionProbabilitySection
- [ ] 通過
- [ ] 失敗
- 問題描述: ___________

### SalesScriptsSection
- [ ] 通過
- [ ] 失敗
- 問題描述: ___________

## 用戶體驗回饋

1. 視覺設計: ___________
2. 互動流程: ___________
3. 資訊呈現: ___________
4. 改進建議: ___________

## 總結

- [ ] 所有功能正常，可以上線
- [ ] 需要修復問題後再上線
- [ ] 需要重大調整
```

---

## 🔧 故障排除

如遇到任何問題，請檢查：

1. **Console 錯誤訊息**
2. **Network 請求是否成功**
3. **Markdown 格式是否正確**
4. **解析器是否正常運作**

如需協助，請提供：
- 錯誤截圖
- Console 日誌
- Analysis ID

---

**文件版本**: 1.0
**最後更新**: 2025-10-25
