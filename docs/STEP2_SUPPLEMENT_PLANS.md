# æ­¥é©Ÿ 2: è£œå……èª²ç¨‹æ–¹æ¡ˆè³‡æ–™

## ğŸ“‹ ç›®æ¨™
æª¢æŸ¥æ‚¨çš„ Supabase è³‡æ–™åº«ï¼Œæ‰¾å‡ºæ‰€æœ‰ä½¿ç”¨ä¸­çš„æ–¹æ¡ˆåç¨±ï¼Œä¸¦è£œå……ç¼ºå°‘çš„æ–¹æ¡ˆå®šç¾©ã€‚

---

## ğŸ” Part A: æª¢æŸ¥ç¾æœ‰æ–¹æ¡ˆ

### 1. å‰å¾€ Supabase Dashboard
- ç™»å…¥ https://supabase.com/dashboard
- é¸æ“‡æ‚¨çš„å°ˆæ¡ˆ
- é»æ“Šå·¦å´é¸å–®çš„ **SQL Editor**

### 2. åŸ·è¡Œæª¢æŸ¥æŸ¥è©¢
- æ‰“é–‹æª”æ¡ˆï¼š`supabase/queries/check-existing-plans.sql`
- è¤‡è£½å…¨éƒ¨å…§å®¹
- è²¼åˆ° SQL Editor ä¸­
- é»æ“Š **Run** åŸ·è¡Œ

### 3. æŸ¥çœ‹çµæœ
æŸ¥è©¢æœƒé¡¯ç¤ºä¸‰å€‹è¡¨æ ¼ï¼š

**è¡¨æ ¼ 1: ç›®å‰ä½¿ç”¨ä¸­çš„æ‰€æœ‰æ–¹æ¡ˆ**
```
æ–¹æ¡ˆåç¨±          | å­¸ç”Ÿæ•¸é‡ | é¦–æ¬¡ä½¿ç”¨æ—¥æœŸ
-----------------|---------|-------------
åˆå­¸å°ˆæ¡ˆ          | 25      | 2024-01-15
é€²éšå°ˆæ¡ˆ          | 18      | 2024-02-01
VIPå°ˆæ¡ˆ           | 10      | 2024-03-10
```

**è¡¨æ ¼ 2: ç¼ºå°‘çš„æ–¹æ¡ˆ** âš ï¸ é‡é»ï¼
```
âŒ ç¼ºå°‘çš„æ–¹æ¡ˆ    | å½±éŸ¿çš„å­¸ç”Ÿæ•¸
----------------|-------------
VIPå°ˆæ¡ˆ          | 10
å¿«é€Ÿå…¥é–€          | 5
```

**è¡¨æ ¼ 3: å·²å­˜åœ¨çš„æ–¹æ¡ˆ** âœ…
```
âœ… å·²å­˜åœ¨çš„æ–¹æ¡ˆ  | ç¸½å ‚æ•¸ | åˆ†é¡   | å•Ÿç”¨
----------------|--------|--------|------
åˆå­¸å°ˆæ¡ˆ         | 4      | é«”é©—èª² | true
é€²éšå°ˆæ¡ˆ         | 6      | é«”é©—èª² | true
```

---

## â• Part B: è£œå……ç¼ºå°‘çš„æ–¹æ¡ˆ

### 1. æ ¹æ“šè¡¨æ ¼ 2 çš„çµæœï¼Œè¨˜éŒ„ç¼ºå°‘çš„æ–¹æ¡ˆ

ä¾‹å¦‚ï¼Œå¦‚æœç¼ºå°‘ï¼š
- `VIPå°ˆæ¡ˆ` (10 ä½å­¸ç”Ÿ)
- `å¿«é€Ÿå…¥é–€` (5 ä½å­¸ç”Ÿ)

### 2. ç·¨è¼¯ insert-missing-plans.sql

æ‰“é–‹ `supabase/queries/insert-missing-plans.sql`ï¼Œä¿®æ”¹ INSERT èªå¥ï¼š

```sql
INSERT INTO course_plans (plan_name, total_classes, category, description, is_active, display_order)
VALUES
  -- æ ¹æ“šæ‚¨çš„å¯¦éš›æƒ…æ³å¡«å¯«
  ('VIPå°ˆæ¡ˆ', 10, 'é«”é©—èª²', 'VIPå°ˆå±¬10å ‚èª²ç¨‹', TRUE, 6),
  ('å¿«é€Ÿå…¥é–€', 2, 'é«”é©—èª²', 'å¿«é€Ÿå…¥é–€2å ‚èª²', TRUE, 7)
ON CONFLICT (plan_name) DO UPDATE SET
  total_classes = EXCLUDED.total_classes,
  updated_at = NOW();
```

**é‡è¦åƒæ•¸èªªæ˜**:
- `plan_name`: å¿…é ˆèˆ‡ `trial_class_purchases.package_name` **å®Œå…¨ä¸€è‡´**
- `total_classes`: è©²æ–¹æ¡ˆçš„ç¸½å ‚æ•¸ï¼ˆç”¨æ–¼è¨ˆç®—å‰©é¤˜å ‚æ•¸ï¼‰
- `category`: é«”é©—èª²ã€æ­£å¼èª²ã€ç‰¹æ®Šæ–¹æ¡ˆ
- `is_active`: TRUE = å•Ÿç”¨ï¼ŒFALSE = åœç”¨
- `display_order`: é¡¯ç¤ºé †åºï¼ˆæ•¸å­—è¶Šå°è¶Šå‰é¢ï¼‰

### 3. åœ¨ Supabase SQL Editor åŸ·è¡Œ

- è¤‡è£½ä¿®æ”¹å¾Œçš„ SQL
- è²¼åˆ° SQL Editor
- é»æ“Š **Run**
- ç¢ºèªåŸ·è¡ŒæˆåŠŸ

### 4. é©—è­‰çµæœ

åŸ·è¡Œæª”æ¡ˆæœ€å¾Œçš„é©—è­‰æŸ¥è©¢ï¼š

```sql
SELECT
  plan_name AS "æ–¹æ¡ˆåç¨±",
  total_classes AS "ç¸½å ‚æ•¸",
  category AS "åˆ†é¡",
  is_active AS "å•Ÿç”¨"
FROM course_plans
ORDER BY display_order;
```

æ‡‰è©²èƒ½çœ‹åˆ°æ‰€æœ‰æ–¹æ¡ˆéƒ½å·²å­˜åœ¨ã€‚

---

## âœ… å®Œæˆæª¢æŸ¥æ¸…å–®

- [ ] Part A: åŸ·è¡Œ `check-existing-plans.sql` æŸ¥è©¢
- [ ] Part A: è¨˜éŒ„æ‰€æœ‰ç¼ºå°‘çš„æ–¹æ¡ˆåç¨±
- [ ] Part B: ä¿®æ”¹ `insert-missing-plans.sql`
- [ ] Part B: åŸ·è¡Œ INSERT èªå¥è£œå……æ–¹æ¡ˆ
- [ ] é©—è­‰ï¼šç¢ºèªæ‰€æœ‰æ–¹æ¡ˆéƒ½å·²å­˜åœ¨
- [ ] å›å ±ï¼šå‘Šè¨´ Claude å“ªäº›æ–¹æ¡ˆå·²è£œå……

---

## ğŸš¨ å¸¸è¦‹å•é¡Œ

### Q1: æ–¹æ¡ˆåç¨±ä¸ä¸€è‡´æ€éº¼è¾¦ï¼Ÿ
**å•é¡Œ**: `trial_class_purchases` ä¸­çš„æ–¹æ¡ˆå«ã€Œåˆç´šæ–¹æ¡ˆã€ï¼Œä½†å¯¦éš›æ‡‰è©²å«ã€Œåˆå­¸å°ˆæ¡ˆã€

**è§£æ±ºæ–¹æ¡ˆ A** (æ¨è–¦): æ›´æ–° course_plans ä½¿ç”¨å¯¦éš›çš„åç¨±
```sql
INSERT INTO course_plans (plan_name, total_classes, category, is_active)
VALUES ('åˆç´šæ–¹æ¡ˆ', 4, 'é«”é©—èª²', TRUE);
```

**è§£æ±ºæ–¹æ¡ˆ B**: æ›´æ–° trial_class_purchases çµ±ä¸€åç¨±
```sql
UPDATE trial_class_purchases
SET package_name = 'åˆå­¸å°ˆæ¡ˆ'
WHERE package_name = 'åˆç´šæ–¹æ¡ˆ';
```

### Q2: ä¸çŸ¥é“æŸå€‹æ–¹æ¡ˆçš„ç¸½å ‚æ•¸ï¼Ÿ
æŸ¥è©¢è©²æ–¹æ¡ˆå­¸ç”Ÿçš„å¯¦éš›ä¸Šèª²è¨˜éŒ„ï¼š

```sql
SELECT
  p.package_name,
  p.student_name,
  COUNT(a.id) as attended_classes
FROM trial_class_purchases p
LEFT JOIN trial_class_attendance a ON p.student_name = a.student_name
WHERE p.package_name = 'VIPå°ˆæ¡ˆ'
GROUP BY p.package_name, p.student_name
ORDER BY attended_classes DESC;
```

çœ‹æœ€å¤šäººä¸Šéå¹¾å ‚èª²ï¼Œæ¨æ¸¬ç¸½å ‚æ•¸ã€‚

### Q3: æœ‰äº›æ–¹æ¡ˆå·²ç¶“åœç”¨äº†ï¼Ÿ
å°‡ `is_active` è¨­ç‚º `FALSE`ï¼š

```sql
UPDATE course_plans
SET is_active = FALSE
WHERE plan_name = 'èˆŠæ–¹æ¡ˆåç¨±';
```

---

## ğŸ“ éœ€è¦å”åŠ©ï¼Ÿ

å®Œæˆå¾Œè«‹å‘Šè¨´æˆ‘ï¼š
1. âœ… åŸ·è¡ŒæˆåŠŸäº†å—ï¼Ÿ
2. ğŸ“ è£œå……äº†å“ªäº›æ–¹æ¡ˆï¼Ÿï¼ˆæ–¹æ¡ˆåç¨± + ç¸½å ‚æ•¸ï¼‰
3. âš ï¸ æœ‰é‡åˆ°ä»»ä½•å•é¡Œå—ï¼Ÿ

æˆ‘æœƒç¹¼çºŒé€²è¡Œ**æ­¥é©Ÿ 3: å¯¦ä½œå¾Œç«¯è‡ªå‹•è¨ˆç®—é‚è¼¯**ï¼
