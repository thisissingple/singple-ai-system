# Replit 環境訪問指南

## 🌐 您的專案網址

### Replit 預覽網址
```
https://workspace.orange32.repl.co
```

**這是您的正確訪問網址！**（不是 localhost:5000）

---

## 📍 頁面導航

### 主 Dashboard 頁面
```
https://workspace.orange32.repl.co/
```

這個頁面有 **3 個標籤**：

```
┌──────────────────────────────────────────────────┐
│ [Google Sheets 管理] [戰力報表] [數據總報表]     │
└──────────────────────────────────────────────────┘
```

---

## 🎯 如何新增 Google Sheets

### Step 1: 打開您的 Replit 預覽
在 Replit 介面中：
1. 點擊頂部的 **「Open Website」** 或 **「Webview」** 按鈕
2. 或直接在瀏覽器開啟：`https://workspace.orange32.repl.co/`

### Step 2: 點擊「Google Sheets 管理」標籤
在頁面頂部會看到 3 個標籤，點擊 **第一個**：
```
[Google Sheets 管理]  ← 點這個
[戰力報表]
[數據總報表]
```

### Step 3: 填寫表單
您會看到：

```
┌──────────────────────────────────────────────────┐
│ ➕ 添加新的 Google Sheets                         │
├──────────────────────────────────────────────────┤
│                                                  │
│ 表格名稱 *              Google Sheets URL *      │
│ ┌──────────────┐       ┌────────────────────┐   │
│ │ 體驗課上課    │       │ https://docs.go... │   │
│ └──────────────┘       └────────────────────┘   │
│                                                  │
│ 描述（可選）                                      │
│ ┌──────────────────────────────────────────┐    │
│ │ 記錄學生體驗課出席狀況                     │    │
│ └──────────────────────────────────────────┘    │
│                                                  │
│ [➕ 添加表格] [初始化報表測試數據源]             │
└──────────────────────────────────────────────────┘
```

**填寫內容**：
1. **表格名稱**：隨意取名，例如 `體驗課上課記錄`
2. **Google Sheets URL**：
   - 打開您的 Google Sheets
   - 複製網址列的完整網址
   - 貼到這裡
   - 格式：`https://docs.google.com/spreadsheets/d/【ID】/edit#gid=0`
3. **描述**：可選填

### Step 4: 點擊「添加表格」
系統會自動執行：
1. ✅ 從 URL 提取 Spreadsheet ID
2. ✅ 驗證 Google Sheets 權限
3. ✅ 讀取所有工作表（worksheets）
4. ✅ 下載資料
5. ✅ **自動同步到 Supabase**

成功後會看到：
```
✅ 創建成功
   新的 Google Sheets 已添加
```

### Step 5: 啟用工作表
表單下方會出現已添加的表格：

```
┌──────────────────────────────────────────────────┐
│ 📄 Google Sheets 列表                             │
├──────────────────────────────────────────────────┤
│ 體驗課上課記錄                                    │
│ 建立時間: 2025-10-01 20:30                       │
│ 最後同步: 2025-10-01 20:31                       │
│ [🔗] [🔄] [🗑️]  [▶ 查看工作表]                  │
└──────────────────────────────────────────────────┘
```

點擊 **[▶ 查看工作表]** 展開：

```
┌──────────────────────────────────────────────────┐
│ 工作表                                            │
├──────────────────────────────────────────────────┤
│ Sheet1              [👁️ 查看資料] [開關] 停用   │
│                                        ↑          │
│                              將這個切到右邊「啟用」│
└──────────────────────────────────────────────────┘
```

**重要**：
- 將 **[開關]** 切換到「啟用」
- 系統會立即同步該工作表到 Supabase

---

## 📊 查看數據總報表

### Step 1: 點擊「數據總報表」標籤
在頁面頂部點擊 **第三個** 標籤：
```
[Google Sheets 管理]
[戰力報表]
[數據總報表]  ← 點這個
```

### Step 2: 查看報表
您會看到完整的數據總報表頁面：
- KPI 指標
- 學生跟進狀態
- 教師視角
- 趨勢圖表
- 欄位盤點按鈕

---

## 🔍 為什麼看到「舊頁面」？

### 問題：瀏覽器快取
您可能看到的是快取的舊版本。

### 解決方法：強制重新整理

#### 方法 1：硬重新整理（推薦）
- **Windows/Linux**: `Ctrl + Shift + R` 或 `Ctrl + F5`
- **Mac**: `Cmd + Shift + R`

#### 方法 2：清除快取
1. 打開開發者工具（`F12`）
2. 右鍵點擊重新整理按鈕
3. 選擇「清除快取並強制重新整理」

#### 方法 3：無痕模式
1. 開啟無痕視窗（`Ctrl + Shift + N`）
2. 貼上網址：`https://workspace.orange32.repl.co/`

---

## 🔑 確認 Service Account 權限

### 您的 Service Account Email
```
replit@replit-473109.iam.gserviceaccount.com
```

### 如何分享 Google Sheets
1. 打開您的 Google Sheets
2. 點擊右上角「共用」按鈕
3. 在「新增使用者或群組」欄位貼上：
   ```
   replit@replit-473109.iam.gserviceaccount.com
   ```
4. 權限選擇「檢視者」
5. 點擊「傳送」

**重要**：每張 Google Sheets 都需要分享！

---

## ✅ 驗證同步成功

### 前端檢查
1. 前往「數據總報表」標籤
2. 查看頁面右上角是否顯示：
   ```
   即時資料模式 · 資料來源：Supabase
   ```
3. 查看是否有警告訊息：
   ```
   ⚠️ 使用 Supabase 資料來源（XX 筆記錄）
   ```
4. 檢查 KPI 數字是否正確
5. 檢查學生跟進狀態是否有真實資料

### Supabase 檢查
1. 登入 Supabase Dashboard
2. 前往 Table Editor
3. 查看三張表：
   - `trial_class_attendance` - 應該有您的上課記錄
   - `trial_class_purchase` - 應該有您的購買記錄
   - `eods_for_closers` - 應該有您的成交記錄

---

## 🔄 自動同步機制

### 定期同步
系統會 **每 5 分鐘** 自動重新同步所有已啟用的 Google Sheets

### 手動同步
您可以隨時點擊：
- [🔄] 按鈕（同步整個 Spreadsheet）
- 或工作表旁的 [🔄] 按鈕（同步單個工作表）

---

## 🎯 快速檢查清單

- [ ] 打開 `https://workspace.orange32.repl.co/`
- [ ] 點擊「Google Sheets 管理」標籤
- [ ] 看到「添加新的 Google Sheets」表單
- [ ] 填寫表格名稱和 URL
- [ ] 點擊「添加表格」
- [ ] 看到成功訊息
- [ ] 點擊「查看工作表」
- [ ] 將工作表開關切到「啟用」
- [ ] 前往「數據總報表」標籤
- [ ] 確認資料正確顯示

---

## ❓ 常見問題

### Q: 為什麼無法訪問 localhost:5000？
**A**: 因為您在 Replit 環境中，需要使用 Replit 預覽網址：
```
https://workspace.orange32.repl.co/
```

### Q: 為什麼看到舊頁面？
**A**: 瀏覽器快取問題，請使用 `Ctrl + Shift + R` 強制重新整理。

### Q: 為什麼顯示「access denied」？
**A**: Google Sheets 沒有分享給 Service Account。請分享給：
```
replit@replit-473109.iam.gserviceaccount.com
```

### Q: 添加成功但沒有資料？
**A**:
1. 確認工作表已「啟用」
2. 檢查工作表名稱是否包含識別關鍵字
3. 手動點擊 🔄 重新同步

---

## 📞 需要協助？

如果遇到任何問題：
1. 檢查瀏覽器 Console（`F12` → Console）
2. 查看是否有錯誤訊息
3. 提供錯誤訊息以便診斷

---

**版本**: v1.0
**最後更新**: 2025-10-01
