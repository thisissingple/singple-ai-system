# Know-it-all - AI çŸ¥è­˜åº«é¡§å•ç³»çµ±

> **å°ˆæ¡ˆä»£è™Ÿ**: Know-it-all
> **ç›®æ¨™**: æ‰“é€ é€²éšç‰ˆ NotebookLM - å€‹äºº AI å•†æ¥­é¡§å•
> **è¨ªå•æ¬Šé™**: åƒ…é™ xk4xk4563022@gmail.com
> **AI æ¨¡å‹**: GPT-5 (gpt-5)
> **å»ºç«‹æ—¥æœŸ**: 2025-10-29

---

## ğŸ“‹ å°ˆæ¡ˆæ¦‚è¿°

Know-it-all æ˜¯ä¸€å€‹åŸºæ–¼ GPT-5 çš„ç”Ÿæˆå¼çŸ¥è­˜åº«ç³»çµ±,å°ˆç‚ºå•†æ¥­æ±ºç­–æä¾› AI é¡§å•æœå‹™ã€‚ç³»çµ±å¯ä»¥æ¥æ”¶å¤šç¨®æ ¼å¼çš„çŸ¥è­˜è¼¸å…¥,é€éèªç¾©æœå°‹æä¾›ç²¾æº–å›ç­”,ä¸¦å°‡å„ªè³ªå°è©±å›é¥‹åˆ°çŸ¥è­˜åº«ä¸­,å½¢æˆè‡ªæˆ‘æˆé•·çš„çŸ¥è­˜é«”ã€‚

### æ ¸å¿ƒç‰¹è‰²
- ğŸ§  **GPT-5 é©…å‹•** - ä½¿ç”¨æœ€æ–° GPT-5 æ¨¡å‹ (2M TPM, 5K RPM)
- ğŸ“š **å…¨æ ¼å¼æ”¯æ´** - æ–‡å­—ã€PDFã€Wordã€Markdownã€ç¶²é ã€è³‡æ–™åº«
- ğŸ¯ **èªç¾©æœå°‹** - OpenAI Embeddings + pgvector
- â™»ï¸ **è‡ªæˆ‘é€²åŒ–** - å„ªè³ªå›ç­”å¯ç·¨è¼¯å¾Œå›é¥‹çŸ¥è­˜åº«
- ğŸ”’ **ç¨å®¶è¨ªå•** - åƒ…é™æŒ‡å®šå¸³è™Ÿä½¿ç”¨
- ğŸ·ï¸ **æ™ºèƒ½æ¨™ç±¤** - AI è‡ªå‹•å»ºè­°æ¨™ç±¤,æ”¯æ´å¤šæ¨™ç±¤åˆ†é¡

---

## ğŸ¯ éœ€æ±‚è¦æ ¼

### 1. çŸ¥è­˜åº«å…§å®¹æ ¼å¼ (å…¨æ ¼å¼æ”¯æ´)
- âœ… **ç´”æ–‡å­—è¼¸å…¥** - æ‰‹å‹•è¤‡è£½è²¼ä¸Š
- âœ… **æ–‡ä»¶ä¸Šå‚³** - PDF, Word (.docx), Markdown (.md), TXT
- âœ… **ç¶²é é€£çµ** - è‡ªå‹•æŠ“å–ç¶²é å…§å®¹
- âœ… **è³‡æ–™åº«æ•´åˆ** - æ•´åˆç¾æœ‰å­¸å“¡è¨˜éŒ„ã€å ±è¡¨æ•¸æ“š

### 2. å°è©±å›é¥‹æ©Ÿåˆ¶
- âœ… **æ‰‹å‹•æ¨™è¨˜** - æ¯æ¬¡å›è¦†å¾Œå¯é»é¸ã€ŒåŠ å…¥çŸ¥è­˜åº«ã€æŒ‰éˆ•
- âœ… **ç·¨è¼¯åŠŸèƒ½** - å¯ç·¨è¼¯ AI å›è¦†å…§å®¹å¾Œå†å­˜å…¥çŸ¥è­˜åº«
- âœ… **ç‰ˆæœ¬æ§åˆ¶** - ä¿ç•™åŸå§‹å›è¦†èˆ‡ç·¨è¼¯å¾Œç‰ˆæœ¬

### 3. çŸ¥è­˜æª¢ç´¢æ–¹å¼
- âœ… **èªç¾©æœå°‹** - ä½¿ç”¨ OpenAI Embeddings (text-embedding-3-large)
- âœ… **å‘é‡è³‡æ–™åº«** - PostgreSQL + pgvector extension
- âœ… **æ··åˆæª¢ç´¢** - èªç¾©æœå°‹ + é—œéµå­—éæ¿¾ + æ¨™ç±¤ç¯©é¸

### 4. å°è©±è¨˜éŒ„ä¿ç•™ (åˆ†ç´šç®¡ç†)
```
ğŸ—‚ï¸ ç¬¬ä¸€ç´š - æ‰€æœ‰å°è©± (è‡ªå‹•ä¿ç•™)
   â”œâ”€ ä¿ç•™æœŸ: å‰ 3 å€‹æœˆå®Œæ•´ä¿ç•™
   â”œâ”€ åŠŸèƒ½: å¯æœå°‹ã€å¯æŸ¥çœ‹ã€å¯åŒ¯å‡º
   â””â”€ æˆæœ¬: ~1GB å„²å­˜ç©ºé–“

â­ ç¬¬äºŒç´š - å·²æ¨™è¨˜å°è©± (æ‰‹å‹•æ¨™è¨˜)
   â”œâ”€ ä¿ç•™æœŸ: 3-12 å€‹æœˆ
   â”œâ”€ åŠŸèƒ½: ç”¨æˆ¶æŒ‰ã€Œæœ‰ç”¨ã€çš„å°è©±
   â””â”€ ç”¨é€”: å®šæœŸå›é¡§,æŒ‘é¸å„ªè³ªå…§å®¹

ğŸ“š ç¬¬ä¸‰ç´š - çŸ¥è­˜æ–‡ä»¶ (æ°¸ä¹…ä¿ç•™)
   â”œâ”€ ä¿ç•™æœŸ: æ°¸ä¹…
   â”œâ”€ åŠŸèƒ½: ç·¨è¼¯å¾Œæ­£å¼å­˜å…¥çŸ¥è­˜åº«
   â””â”€ ç”¨é€”: ä½œç‚ºæœªä¾†å°è©±çš„ä¸Šä¸‹æ–‡ä¾†æº
```

### 5. çŸ¥è­˜åº«åˆ†é¡ (æ··åˆæ¨™ç±¤æ¶æ§‹)
```
1ï¸âƒ£ ç³»çµ±é è¨­æ¨™ç±¤ (AI è‡ªå‹•å»ºè­°)
   ç‡Ÿé‹ç­–ç•¥ã€éŠ·å”®æŠ€å·§ã€äººäº‹ç®¡ç†ã€æŠ€è¡“æ–‡ä»¶
   è²¡å‹™åˆ†æã€å®¢æˆ¶é—œä¿‚ã€æ•™å­¸å“è³ªã€è¡ŒéŠ·æ¨å»£

2ï¸âƒ£ è‡ªè¨‚æ¨™ç±¤ (æ‰‹å‹•æ·»åŠ )
   ç”¨æˆ¶å¯è‡ªç”±å‰µå»ºæ–°æ¨™ç±¤
   æ”¯æ´å¤šæ¨™ç±¤ (ä¸€å€‹æ–‡ä»¶å¯æœ‰å¤šå€‹æ¨™ç±¤)

3ï¸âƒ£ æ™ºèƒ½æ¨™ç±¤ (AI è‡ªå‹•ç”¢ç”Ÿ)
   ä¸Šå‚³æ–‡ä»¶æ™‚,AI åˆ†æå…§å®¹è‡ªå‹•å»ºè­°æ¨™ç±¤
   å­¸ç¿’ç”¨æˆ¶æ¨™ç±¤ç¿’æ…£,æé«˜å»ºè­°æº–ç¢ºåº¦
```

### 6. è¨ªå•å…¥å£
- **ä½ç½®**: `/tools/ai-advisor` (å·¥å…·é¸å–®ä¸‹)
- **å°èˆª**: å´é‚Šæ¬„ã€Œå·¥å…·ã€â†’ã€ŒAI é¡§å• (Know-it-all)ã€
- **åœ–ç¤º**: ğŸ§  æˆ– ğŸ’¡

### 7. è¨ªå•æ¬Šé™æ§åˆ¶
- **ç™½åå–®**: `xk4xk4563022@gmail.com`
- **é©—è­‰å±¤ç´š**:
  1. å¾Œç«¯ä¸­ä»‹å±¤æª¢æŸ¥ (ä¸»è¦é˜²è­·)
  2. å‰ç«¯è·¯ç”±å®ˆè¡› (è¼”åŠ©éš±è—)
  3. å°èˆªé¸å–®æ¢ä»¶é¡¯ç¤º (åƒ…å…è¨±ç”¨æˆ¶å¯è¦‹)

---

## ğŸ—ï¸ æŠ€è¡“æ¶æ§‹

### è³‡æ–™åº«è¨­è¨ˆ

#### æ–°å¢è³‡æ–™è¡¨ 1: `knowledge_base_documents`
```sql
CREATE TABLE knowledge_base_documents (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),

  -- åŸºæœ¬è³‡è¨Š
  title TEXT NOT NULL,
  content TEXT NOT NULL,
  content_summary TEXT, -- AI è‡ªå‹•ç”Ÿæˆçš„æ‘˜è¦

  -- å‘é‡æœå°‹
  content_embedding VECTOR(3072), -- text-embedding-3-large çš„å‘é‡ç¶­åº¦

  -- åˆ†é¡èˆ‡æ¨™ç±¤
  category TEXT, -- ä¸»åˆ†é¡
  tags TEXT[], -- å¤šæ¨™ç±¤é™£åˆ—

  -- ä¾†æºè³‡è¨Š
  source_type TEXT CHECK (source_type IN ('manual', 'file', 'url', 'database', 'conversation')),
  source_reference TEXT, -- æª”æ¡ˆè·¯å¾‘ã€URLã€è³‡æ–™åº«æŸ¥è©¢ç­‰
  original_filename TEXT,
  file_type TEXT, -- pdf, docx, md, txt, html

  -- å…§å®¹çµ±è¨ˆ
  word_count INTEGER,
  token_count INTEGER,

  -- æ¬Šé™æ§åˆ¶
  created_by UUID REFERENCES users(id),
  is_public BOOLEAN DEFAULT false, -- æœªä¾†å¯èƒ½é–‹æ”¾çµ¦å…¶ä»–ç”¨æˆ¶

  -- æ™‚é–“æˆ³è¨˜
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  last_accessed_at TIMESTAMPTZ,

  -- ç´¢å¼•å„ªåŒ–
  search_vector tsvector -- PostgreSQL å…¨æ–‡æœå°‹ (è¼”åŠ©)
);

-- ç´¢å¼•
CREATE INDEX idx_kb_docs_embedding ON knowledge_base_documents
  USING ivfflat (content_embedding vector_cosine_ops);
CREATE INDEX idx_kb_docs_tags ON knowledge_base_documents USING GIN (tags);
CREATE INDEX idx_kb_docs_category ON knowledge_base_documents (category);
CREATE INDEX idx_kb_docs_created_by ON knowledge_base_documents (created_by);
CREATE INDEX idx_kb_docs_source_type ON knowledge_base_documents (source_type);
CREATE INDEX idx_kb_docs_search_vector ON knowledge_base_documents USING GIN (search_vector);
```

#### æ–°å¢è³‡æ–™è¡¨ 2: `know_it_all_conversations`
```sql
CREATE TABLE know_it_all_conversations (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),

  -- ç”¨æˆ¶èˆ‡å°è©±
  user_id UUID NOT NULL REFERENCES users(id),
  conversation_id UUID NOT NULL, -- åŒä¸€å€‹å°è©±ä¸²çš„ ID
  message_index INTEGER NOT NULL, -- è¨Šæ¯åœ¨å°è©±ä¸­çš„é †åº

  -- è¨Šæ¯å…§å®¹
  role TEXT NOT NULL CHECK (role IN ('user', 'assistant', 'system')),
  content TEXT NOT NULL,

  -- AI å›æ‡‰è³‡è¨Š (åƒ… assistant è§’è‰²)
  model TEXT, -- gpt-5, gpt-5-mini
  temperature NUMERIC(3, 2),
  tokens_used INTEGER,
  prompt_tokens INTEGER,
  completion_tokens INTEGER,
  api_cost_usd NUMERIC(10, 6),

  -- ä¸Šä¸‹æ–‡è³‡è¨Š
  documents_referenced UUID[], -- å¼•ç”¨çš„çŸ¥è­˜æ–‡ä»¶ ID é™£åˆ—
  database_queries TEXT[], -- å¦‚æœæŸ¥è©¢äº†è³‡æ–™åº«,è¨˜éŒ„ SQL

  -- ç”¨æˆ¶å›é¥‹
  is_marked_useful BOOLEAN DEFAULT false, -- ç”¨æˆ¶æ˜¯å¦æ¨™è¨˜ç‚ºæœ‰ç”¨
  is_added_to_knowledge BOOLEAN DEFAULT false, -- æ˜¯å¦å·²åŠ å…¥çŸ¥è­˜åº«
  knowledge_document_id UUID REFERENCES knowledge_base_documents(id), -- é—œè¯çš„çŸ¥è­˜æ–‡ä»¶

  -- æ™‚é–“æˆ³è¨˜
  created_at TIMESTAMPTZ DEFAULT NOW(),
  marked_at TIMESTAMPTZ,
  added_to_knowledge_at TIMESTAMPTZ
);

-- ç´¢å¼•
CREATE INDEX idx_kia_conv_user ON know_it_all_conversations (user_id);
CREATE INDEX idx_kia_conv_conversation ON know_it_all_conversations (conversation_id);
CREATE INDEX idx_kia_conv_marked ON know_it_all_conversations (is_marked_useful)
  WHERE is_marked_useful = true;
CREATE INDEX idx_kia_conv_added ON know_it_all_conversations (is_added_to_knowledge)
  WHERE is_added_to_knowledge = true;
```

#### æ–°å¢è³‡æ–™è¡¨ 3: `know_it_all_conversation_metadata`
```sql
CREATE TABLE know_it_all_conversation_metadata (
  conversation_id UUID PRIMARY KEY,

  -- å°è©±è³‡è¨Š
  title TEXT, -- å°è©±æ¨™é¡Œ (AI è‡ªå‹•ç”Ÿæˆæˆ–ç”¨æˆ¶è‡ªè¨‚)
  user_id UUID NOT NULL REFERENCES users(id),

  -- çµ±è¨ˆè³‡è¨Š
  message_count INTEGER DEFAULT 0,
  total_tokens_used INTEGER DEFAULT 0,
  total_cost_usd NUMERIC(10, 6) DEFAULT 0,

  -- æ™‚é–“æˆ³è¨˜
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  last_message_at TIMESTAMPTZ,

  -- æ­¸æª”ç‹€æ…‹
  is_archived BOOLEAN DEFAULT false,
  archived_at TIMESTAMPTZ
);

CREATE INDEX idx_kia_meta_user ON know_it_all_conversation_metadata (user_id);
CREATE INDEX idx_kia_meta_updated ON know_it_all_conversation_metadata (updated_at DESC);
```

### å¾Œç«¯æœå‹™æ¶æ§‹

```
server/services/know-it-all/
â”œâ”€â”€ knowledge-base-document-service.ts    # æ–‡ä»¶ç®¡ç†æœå‹™
â”‚   â”œâ”€â”€ uploadDocument()
â”‚   â”œâ”€â”€ createFromText()
â”‚   â”œâ”€â”€ createFromUrl()
â”‚   â”œâ”€â”€ updateDocument()
â”‚   â”œâ”€â”€ deleteDocument()
â”‚   â”œâ”€â”€ listDocuments()
â”‚   â””â”€â”€ searchDocuments()
â”‚
â”œâ”€â”€ knowledge-base-embedding-service.ts   # å‘é‡åµŒå…¥æœå‹™
â”‚   â”œâ”€â”€ generateEmbedding()
â”‚   â”œâ”€â”€ batchGenerateEmbeddings()
â”‚   â”œâ”€â”€ semanticSearch()
â”‚   â””â”€â”€ hybridSearch()
â”‚
â”œâ”€â”€ know-it-all-chat-service.ts           # å°è©±å¼•æ“æœå‹™
â”‚   â”œâ”€â”€ chat()
â”‚   â”œâ”€â”€ getConversationHistory()
â”‚   â”œâ”€â”€ createNewConversation()
â”‚   â”œâ”€â”€ listConversations()
â”‚   â”œâ”€â”€ markMessageUseful()
â”‚   â””â”€â”€ addMessageToKnowledge()
â”‚
â”œâ”€â”€ document-parser-service.ts            # æ–‡ä»¶è§£ææœå‹™
â”‚   â”œâ”€â”€ parsePDF()
â”‚   â”œâ”€â”€ parseDocx()
â”‚   â”œâ”€â”€ parseMarkdown()
â”‚   â”œâ”€â”€ parseTxt()
â”‚   â”œâ”€â”€ parseHtml()
â”‚   â””â”€â”€ extractTextFromUrl()
â”‚
â””â”€â”€ ai-tag-suggestion-service.ts          # æ™ºèƒ½æ¨™ç±¤æœå‹™
    â”œâ”€â”€ suggestTags()
    â”œâ”€â”€ learnFromUserTags()
    â””â”€â”€ getPopularTags()
```

### API ç«¯é»è¨­è¨ˆ

```typescript
// server/routes-know-it-all.ts

import { Express } from 'express';
import { isAuthenticated } from './auth';
import { requireKnowItAllAccess } from './middleware/know-it-all-access';

export function registerKnowItAllRoutes(app: Express) {

  // ===== æ–‡ä»¶ç®¡ç† API =====

  // ä¸Šå‚³æ–‡ä»¶ (æ”¯æ´å¤šç¨®æ ¼å¼)
  app.post('/api/know-it-all/documents/upload',
    isAuthenticated,
    requireKnowItAllAccess,
    upload.single('file'),
    async (req, res) => {
      // è™•ç†æ–‡ä»¶ä¸Šå‚³ã€è§£æã€å‘é‡åŒ–
    }
  );

  // å¾æ–‡å­—å‰µå»ºæ–‡ä»¶
  app.post('/api/know-it-all/documents/from-text',
    isAuthenticated,
    requireKnowItAllAccess,
    async (req, res) => {
      const { title, content, tags, category } = req.body;
      // å‰µå»ºæ–‡ä»¶ + ç”Ÿæˆ embedding
    }
  );

  // å¾ç¶²å€å‰µå»ºæ–‡ä»¶
  app.post('/api/know-it-all/documents/from-url',
    isAuthenticated,
    requireKnowItAllAccess,
    async (req, res) => {
      const { url, tags, category } = req.body;
      // æŠ“å–ç¶²é  + è§£æ + å‰µå»ºæ–‡ä»¶
    }
  );

  // åˆ—å‡ºæ‰€æœ‰æ–‡ä»¶
  app.get('/api/know-it-all/documents',
    isAuthenticated,
    requireKnowItAllAccess,
    async (req, res) => {
      const { category, tags, limit, offset } = req.query;
      // è¿”å›æ–‡ä»¶åˆ—è¡¨ + åˆ†é 
    }
  );

  // å–å¾—å–®ä¸€æ–‡ä»¶è©³æƒ…
  app.get('/api/know-it-all/documents/:id',
    isAuthenticated,
    requireKnowItAllAccess,
    async (req, res) => {
      // è¿”å›æ–‡ä»¶å®Œæ•´å…§å®¹
    }
  );

  // æ›´æ–°æ–‡ä»¶
  app.put('/api/know-it-all/documents/:id',
    isAuthenticated,
    requireKnowItAllAccess,
    async (req, res) => {
      // æ›´æ–°æ–‡ä»¶ + é‡æ–°ç”Ÿæˆ embedding (å¦‚æœå…§å®¹è®Šæ›´)
    }
  );

  // åˆªé™¤æ–‡ä»¶
  app.delete('/api/know-it-all/documents/:id',
    isAuthenticated,
    requireKnowItAllAccess,
    async (req, res) => {
      // è»Ÿåˆªé™¤æˆ–ç¡¬åˆªé™¤
    }
  );

  // æœå°‹æ–‡ä»¶ (èªç¾©æœå°‹)
  app.post('/api/know-it-all/documents/search',
    isAuthenticated,
    requireKnowItAllAccess,
    async (req, res) => {
      const { query, limit, category, tags } = req.body;
      // ç”ŸæˆæŸ¥è©¢ embedding + å‘é‡æœå°‹ + éæ¿¾
    }
  );

  // ===== å°è©± API =====

  // ç™¼é€è¨Šæ¯ (ä¸»è¦å°è©±ç«¯é»)
  app.post('/api/know-it-all/chat',
    isAuthenticated,
    requireKnowItAllAccess,
    async (req, res) => {
      const { message, conversationId, model, options } = req.body;
      // 1. æœå°‹ç›¸é—œçŸ¥è­˜æ–‡ä»¶
      // 2. æ§‹å»ºä¸Šä¸‹æ–‡ (å°è©±æ­·å² + çŸ¥è­˜æ–‡ä»¶)
      // 3. å‘¼å« GPT-5 API
      // 4. å„²å­˜å°è©±è¨˜éŒ„
      // 5. è¿”å›å›æ‡‰ + å¼•ç”¨ä¾†æº
    }
  );

  // å‰µå»ºæ–°å°è©±
  app.post('/api/know-it-all/conversations',
    isAuthenticated,
    requireKnowItAllAccess,
    async (req, res) => {
      // å‰µå»ºæ–°çš„ conversation_id
    }
  );

  // åˆ—å‡ºæ‰€æœ‰å°è©±
  app.get('/api/know-it-all/conversations',
    isAuthenticated,
    requireKnowItAllAccess,
    async (req, res) => {
      // è¿”å›å°è©±åˆ—è¡¨ (æŒ‰æœ€æ–°è¨Šæ¯æ’åº)
    }
  );

  // å–å¾—å°è©±æ­·å²
  app.get('/api/know-it-all/conversations/:conversationId',
    isAuthenticated,
    requireKnowItAllAccess,
    async (req, res) => {
      // è¿”å›å®Œæ•´å°è©±è¨˜éŒ„
    }
  );

  // åˆªé™¤å°è©±
  app.delete('/api/know-it-all/conversations/:conversationId',
    isAuthenticated,
    requireKnowItAllAccess,
    async (req, res) => {
      // åˆªé™¤å°è©± (è»Ÿåˆªé™¤,æ¨™è¨˜ç‚º archived)
    }
  );

  // ===== å›é¥‹æ©Ÿåˆ¶ API =====

  // æ¨™è¨˜è¨Šæ¯ç‚ºã€Œæœ‰ç”¨ã€
  app.post('/api/know-it-all/messages/:messageId/mark-useful',
    isAuthenticated,
    requireKnowItAllAccess,
    async (req, res) => {
      // æ›´æ–° is_marked_useful æ¬„ä½
    }
  );

  // å°‡è¨Šæ¯åŠ å…¥çŸ¥è­˜åº«
  app.post('/api/know-it-all/messages/:messageId/add-to-knowledge',
    isAuthenticated,
    requireKnowItAllAccess,
    async (req, res) => {
      const { editedContent, title, tags, category } = req.body;
      // 1. å‰µå»ºæ–°çš„çŸ¥è­˜æ–‡ä»¶
      // 2. ç”Ÿæˆ embedding
      // 3. æ›´æ–°åŸè¨Šæ¯çš„ is_added_to_knowledge æ¬„ä½
    }
  );

  // å–å¾—å·²æ¨™è¨˜çš„è¨Šæ¯åˆ—è¡¨
  app.get('/api/know-it-all/messages/marked',
    isAuthenticated,
    requireKnowItAllAccess,
    async (req, res) => {
      // è¿”å›æ‰€æœ‰æ¨™è¨˜ç‚ºæœ‰ç”¨çš„è¨Šæ¯
    }
  );

  // ===== æ¨™ç±¤ç®¡ç† API =====

  // AI å»ºè­°æ¨™ç±¤
  app.post('/api/know-it-all/tags/suggest',
    isAuthenticated,
    requireKnowItAllAccess,
    async (req, res) => {
      const { content } = req.body;
      // ä½¿ç”¨ GPT-5 åˆ†æå…§å®¹,å»ºè­°æ¨™ç±¤
    }
  );

  // å–å¾—æ‰€æœ‰æ¨™ç±¤ (å«ä½¿ç”¨æ¬¡æ•¸)
  app.get('/api/know-it-all/tags',
    isAuthenticated,
    requireKnowItAllAccess,
    async (req, res) => {
      // è¿”å›æ‰€æœ‰æ¨™ç±¤ + çµ±è¨ˆè³‡è¨Š
    }
  );

  // ===== çµ±è¨ˆèˆ‡åˆ†æ API =====

  // å–å¾—ä½¿ç”¨çµ±è¨ˆ
  app.get('/api/know-it-all/stats',
    isAuthenticated,
    requireKnowItAllAccess,
    async (req, res) => {
      // è¿”å›:
      // - ç¸½æ–‡ä»¶æ•¸
      // - ç¸½å°è©±æ•¸
      // - æœ¬æœˆå°è©±æ•¸
      // - ç¸½ token ä½¿ç”¨é‡
      // - ç¸½æˆæœ¬
    }
  );

  // æˆæœ¬è¿½è¹¤
  app.get('/api/know-it-all/costs',
    isAuthenticated,
    requireKnowItAllAccess,
    async (req, res) => {
      const { startDate, endDate } = req.query;
      // è¿”å›æŒ‡å®šæœŸé–“çš„æˆæœ¬æ˜ç´°
    }
  );

  // ===== è³‡æ–™åº«æ•´åˆ API =====

  // æŸ¥è©¢å­¸å“¡è³‡æ–™
  app.post('/api/know-it-all/database/students/search',
    isAuthenticated,
    requireKnowItAllAccess,
    async (req, res) => {
      const { query } = req.body;
      // ä½¿ç”¨ GPT-5 å°‡è‡ªç„¶èªè¨€è½‰ç‚º SQL æŸ¥è©¢
      // åŸ·è¡ŒæŸ¥è©¢ä¸¦è¿”å›çµæœ
    }
  );

  // å–å¾—å ±è¡¨æ•¸æ“š
  app.post('/api/know-it-all/database/reports',
    isAuthenticated,
    requireKnowItAllAccess,
    async (req, res) => {
      const { reportType, period } = req.body;
      // æ•´åˆç¾æœ‰çš„å ±è¡¨ç³»çµ±
    }
  );
}
```

### ä¸­ä»‹å±¤è¨­è¨ˆ

```typescript
// server/middleware/know-it-all-access.ts

import { RequestHandler } from 'express';

const ALLOWED_EMAILS = ['xk4xk4563022@gmail.com'];

export const requireKnowItAllAccess: RequestHandler = async (req, res, next) => {
  // é–‹ç™¼æ¨¡å¼è·³éæª¢æŸ¥
  if (process.env.SKIP_AUTH === 'true') {
    return next();
  }

  const user = (req as any).user;

  if (!user) {
    return res.status(401).json({
      success: false,
      message: 'Unauthorized - Please login first'
    });
  }

  if (!ALLOWED_EMAILS.includes(user.email)) {
    console.warn(`[Know-it-all] Unauthorized access attempt by ${user.email}`);
    return res.status(403).json({
      success: false,
      message: 'Access denied - This feature is restricted to authorized users only'
    });
  }

  // è¨˜éŒ„è¨ªå•æ—¥èªŒ (å¯é¸)
  console.log(`[Know-it-all] Access granted to ${user.email}`);

  next();
};
```

### å‰ç«¯æ¶æ§‹

```
client/src/pages/tools/know-it-all/
â”œâ”€â”€ index.tsx                         # ä¸»é é¢ (å°è©±ä»‹é¢)
â”œâ”€â”€ documents.tsx                     # æ–‡ä»¶ç®¡ç†é é¢
â”œâ”€â”€ conversations.tsx                 # å°è©±æ­·å²é é¢
â”œâ”€â”€ stats.tsx                         # çµ±è¨ˆé é¢

client/src/components/know-it-all/
â”œâ”€â”€ chat-interface.tsx                # å°è©±ä»‹é¢ä¸»å…ƒä»¶
â”œâ”€â”€ message-bubble.tsx                # è¨Šæ¯æ°£æ³¡
â”œâ”€â”€ message-actions.tsx               # è¨Šæ¯æ“ä½œ (æ¨™è¨˜ã€åŠ å…¥çŸ¥è­˜åº«)
â”œâ”€â”€ document-uploader.tsx             # æ–‡ä»¶ä¸Šå‚³å™¨
â”œâ”€â”€ document-card.tsx                 # æ–‡ä»¶å¡ç‰‡
â”œâ”€â”€ document-list.tsx                 # æ–‡ä»¶åˆ—è¡¨
â”œâ”€â”€ tag-selector.tsx                  # æ¨™ç±¤é¸æ“‡å™¨
â”œâ”€â”€ conversation-sidebar.tsx          # å°è©±å´é‚Šæ¬„
â”œâ”€â”€ source-citations.tsx              # ä¾†æºå¼•ç”¨é¡¯ç¤º
â””â”€â”€ edit-modal.tsx                    # ç·¨è¼¯å›è¦†çš„å½ˆçª—
```

---

## ğŸ”§ å¯¦ä½œæ­¥é©Ÿ

### Phase 1: è³‡æ–™åº«èˆ‡å¾Œç«¯åŸºç¤ (3-4 å°æ™‚)

#### 1.1 è³‡æ–™åº«è¨­ç½® (30 åˆ†é˜)
- [ ] æª¢æŸ¥ pgvector extension æ˜¯å¦å·²å®‰è£
  ```sql
  CREATE EXTENSION IF NOT EXISTS vector;
  ```
- [ ] å‰µå»º migration: `supabase/migrations/044_create_know_it_all_system.sql`
- [ ] åŒ…å«æ‰€æœ‰ 3 å¼µè³‡æ–™è¡¨
- [ ] åŸ·è¡Œ migration

#### 1.2 ä¸­ä»‹å±¤å¯¦ä½œ (30 åˆ†é˜)
- [ ] å‰µå»º `server/middleware/know-it-all-access.ts`
- [ ] å¯¦ä½œ `requireKnowItAllAccess` å‡½å¼
- [ ] åŠ å…¥è¨ªå•æ—¥èªŒè¨˜éŒ„

#### 1.3 æ ¸å¿ƒæœå‹™ - æ–‡ä»¶ç®¡ç† (2 å°æ™‚)
- [ ] å‰µå»º `server/services/know-it-all/knowledge-base-document-service.ts`
  - [ ] `createDocument()` - å‰µå»ºæ–‡ä»¶
  - [ ] `updateDocument()` - æ›´æ–°æ–‡ä»¶
  - [ ] `deleteDocument()` - åˆªé™¤æ–‡ä»¶
  - [ ] `listDocuments()` - åˆ—å‡ºæ–‡ä»¶ (æ”¯æ´éæ¿¾èˆ‡åˆ†é )
  - [ ] `getDocumentById()` - å–å¾—å–®ä¸€æ–‡ä»¶

#### 1.4 æ ¸å¿ƒæœå‹™ - å‘é‡åµŒå…¥ (1 å°æ™‚)
- [ ] å‰µå»º `server/services/know-it-all/knowledge-base-embedding-service.ts`
  - [ ] `generateEmbedding()` - å‘¼å« OpenAI Embeddings API
  - [ ] `semanticSearch()` - å‘é‡æœå°‹
  - [ ] ä½¿ç”¨ pgvector çš„ cosine similarity
  ```typescript
  SELECT id, title, content,
         1 - (content_embedding <=> $1) as similarity
  FROM knowledge_base_documents
  WHERE 1 - (content_embedding <=> $1) > 0.7
  ORDER BY similarity DESC
  LIMIT 5;
  ```

---

### Phase 2: æ–‡ä»¶è§£æèˆ‡ä¸Šå‚³ (2-3 å°æ™‚)

#### 2.1 æ–‡ä»¶è§£ææœå‹™ (2 å°æ™‚)
- [ ] å‰µå»º `server/services/know-it-all/document-parser-service.ts`
- [ ] å®‰è£ä¾è³´å¥—ä»¶:
  ```bash
  npm install pdf-parse mammoth cheerio axios
  ```
- [ ] å¯¦ä½œè§£æå™¨:
  - [ ] `parsePDF()` - ä½¿ç”¨ `pdf-parse`
  - [ ] `parseDocx()` - ä½¿ç”¨ `mammoth`
  - [ ] `parseMarkdown()` - åŸºæœ¬æ–‡å­—è™•ç†
  - [ ] `parseTxt()` - ç›´æ¥è®€å–
  - [ ] `parseHtml()` - ä½¿ç”¨ `cheerio`
  - [ ] `extractTextFromUrl()` - æŠ“å–ç¶²é å…§å®¹

#### 2.2 æª”æ¡ˆä¸Šå‚³ç«¯é» (1 å°æ™‚)
- [ ] å‰µå»º `server/routes-know-it-all.ts`
- [ ] è¨­ç½® multer ä¸­ä»‹å±¤ (æª”æ¡ˆä¸Šå‚³)
  ```typescript
  import multer from 'multer';
  const upload = multer({
    dest: 'uploads/know-it-all/',
    limits: { fileSize: 10 * 1024 * 1024 } // 10MB
  });
  ```
- [ ] å¯¦ä½œ `/api/know-it-all/documents/upload` ç«¯é»
- [ ] å¯¦ä½œ `/api/know-it-all/documents/from-text` ç«¯é»
- [ ] å¯¦ä½œ `/api/know-it-all/documents/from-url` ç«¯é»
- [ ] åœ¨ `server/index.ts` è¨»å†Šè·¯ç”±

---

### Phase 3: å°è©±å¼•æ“ (3-4 å°æ™‚)

#### 3.1 å°è©±æœå‹™æ ¸å¿ƒ (2.5 å°æ™‚)
- [ ] å‰µå»º `server/services/know-it-all/know-it-all-chat-service.ts`
- [ ] å¯¦ä½œ `chat()` å‡½å¼:
  ```typescript
  async function chat(params: {
    userId: string;
    conversationId: string;
    message: string;
    model?: string;
    options?: ChatOptions;
  }): Promise<ChatResponse> {
    // 1. æœå°‹ç›¸é—œçŸ¥è­˜æ–‡ä»¶ (èªç¾©æœå°‹)
    const relevantDocs = await embeddingService.semanticSearch(message, 5);

    // 2. è¼‰å…¥å°è©±æ­·å²
    const history = await getConversationHistory(conversationId);

    // 3. æ§‹å»º GPT-5 prompt
    const systemPrompt = buildSystemPrompt(relevantDocs);
    const messages = [
      { role: 'system', content: systemPrompt },
      ...history.map(msg => ({ role: msg.role, content: msg.content })),
      { role: 'user', content: message }
    ];

    // 4. å‘¼å« OpenAI API
    const openai = new OpenAI({ apiKey: process.env.OPENAI_API_KEY });
    const completion = await openai.chat.completions.create({
      model: model || 'gpt-5',
      messages,
      temperature: 0.7,
      max_tokens: 2000
    });

    // 5. è¨ˆç®—æˆæœ¬
    const cost = calculateCost(completion.usage);

    // 6. å„²å­˜å°è©±è¨˜éŒ„
    await saveConversationMessages({
      conversationId,
      userMessage: message,
      assistantMessage: completion.choices[0].message.content,
      documentsReferenced: relevantDocs.map(d => d.id),
      tokensUsed: completion.usage.total_tokens,
      cost
    });

    // 7. è¿”å›å›æ‡‰
    return {
      message: completion.choices[0].message.content,
      sources: relevantDocs,
      tokensUsed: completion.usage.total_tokens,
      cost
    };
  }
  ```

#### 3.2 System Prompt è¨­è¨ˆ (30 åˆ†é˜)
- [ ] è¨­è¨ˆæ ¸å¿ƒ system prompt:
  ```typescript
  function buildSystemPrompt(relevantDocs: Document[]): string {
    return `ä½ æ˜¯ Know-it-all,ä¸€å€‹å°ˆæ¥­çš„å•†æ¥­é¡§å• AI åŠ©æ‰‹ã€‚

ä½ çš„è§’è‰²:
- ä½ æ˜¯ç”¨æˆ¶çš„å€‹äºº AI é¡§å•,å°ˆæ³¨æ–¼å•†æ¥­æ±ºç­–èˆ‡ç­–ç•¥å»ºè­°
- ä½ æ“æœ‰ç”¨æˆ¶ç´¯ç©çš„æ‰€æœ‰å•†æ¥­çŸ¥è­˜èˆ‡ç¶“é©—
- ä½ çš„å›ç­”æ‡‰è©²ç²¾æº–ã€å¯¦ç”¨ã€å¯åŸ·è¡Œ

çŸ¥è­˜ä¾†æº:
ä»¥ä¸‹æ˜¯èˆ‡ç”¨æˆ¶å•é¡Œç›¸é—œçš„çŸ¥è­˜æ–‡ä»¶:

${relevantDocs.map((doc, i) => `
[æ–‡ä»¶ ${i + 1}] ${doc.title}
æ¨™ç±¤: ${doc.tags.join(', ')}
å…§å®¹æ‘˜è¦:
${doc.content_summary || doc.content.substring(0, 500)}
`).join('\n---\n')}

å›ç­”æŒ‡å—:
1. å„ªå…ˆä½¿ç”¨ä¸Šè¿°çŸ¥è­˜æ–‡ä»¶ä¸­çš„è³‡è¨Š
2. å¦‚æœçŸ¥è­˜æ–‡ä»¶ä¸è¶³ä»¥å›ç­”,å¯ä»¥ä½¿ç”¨ä½ çš„é€šç”¨çŸ¥è­˜,ä½†è«‹æ˜ç¢ºèªªæ˜
3. å¼•ç”¨ä¾†æºæ™‚,ä½¿ç”¨ [æ–‡ä»¶ N] çš„æ ¼å¼
4. å›ç­”è¦å…·é«”ã€å¯åŸ·è¡Œ,é¿å…ç©ºæ³›çš„å»ºè­°
5. å¦‚æœä¸ç¢ºå®š,èª å¯¦èªªæ˜ä¸¦å»ºè­°éœ€è¦è£œå……å“ªäº›è³‡è¨Š

èªæ°£:
- å°ˆæ¥­ä½†å‹å–„
- ç›´æ¥ä¸”é«˜æ•ˆ
- åƒæ˜¯ä¸€å€‹ç¶“é©—è±å¯Œçš„å•†æ¥­å¤¥ä¼´`;
  }
  ```

#### 3.3 å°è©± API ç«¯é» (1 å°æ™‚)
- [ ] å¯¦ä½œ `/api/know-it-all/chat` (ä¸»è¦å°è©±ç«¯é»)
- [ ] å¯¦ä½œ `/api/know-it-all/conversations` (å‰µå»º/åˆ—å‡ºå°è©±)
- [ ] å¯¦ä½œ `/api/know-it-all/conversations/:id` (å–å¾—å°è©±æ­·å²)

---

### Phase 4: å›é¥‹æ©Ÿåˆ¶ (1-2 å°æ™‚)

#### 4.1 å›é¥‹æœå‹™ (1 å°æ™‚)
- [ ] åœ¨ `know-it-all-chat-service.ts` åŠ å…¥:
  - [ ] `markMessageUseful()` - æ¨™è¨˜è¨Šæ¯ç‚ºæœ‰ç”¨
  - [ ] `addMessageToKnowledge()` - å°‡è¨Šæ¯åŠ å…¥çŸ¥è­˜åº«
    ```typescript
    async function addMessageToKnowledge(params: {
      messageId: string;
      editedContent?: string;
      title: string;
      tags: string[];
      category?: string;
    }): Promise<Document> {
      // 1. å–å¾—åŸå§‹è¨Šæ¯
      const message = await getMessage(messageId);

      // 2. ä½¿ç”¨ç·¨è¼¯å¾Œçš„å…§å®¹ (æˆ–åŸå§‹å…§å®¹)
      const content = editedContent || message.content;

      // 3. ç”Ÿæˆ embedding
      const embedding = await embeddingService.generateEmbedding(content);

      // 4. å‰µå»ºçŸ¥è­˜æ–‡ä»¶
      const document = await documentService.createDocument({
        title,
        content,
        content_embedding: embedding,
        tags,
        category,
        source_type: 'conversation',
        source_reference: messageId,
        created_by: message.user_id
      });

      // 5. æ›´æ–°åŸè¨Šæ¯ç‹€æ…‹
      await updateMessage(messageId, {
        is_added_to_knowledge: true,
        knowledge_document_id: document.id,
        added_to_knowledge_at: new Date()
      });

      return document;
    }
    ```

#### 4.2 å›é¥‹ API ç«¯é» (1 å°æ™‚)
- [ ] å¯¦ä½œ `/api/know-it-all/messages/:id/mark-useful`
- [ ] å¯¦ä½œ `/api/know-it-all/messages/:id/add-to-knowledge`
- [ ] å¯¦ä½œ `/api/know-it-all/messages/marked` (åˆ—å‡ºå·²æ¨™è¨˜è¨Šæ¯)

---

### Phase 5: æ¨™ç±¤ç³»çµ± (1 å°æ™‚)

#### 5.1 æ™ºèƒ½æ¨™ç±¤æœå‹™ (30 åˆ†é˜)
- [ ] å‰µå»º `server/services/know-it-all/ai-tag-suggestion-service.ts`
- [ ] å¯¦ä½œ `suggestTags()`:
  ```typescript
  async function suggestTags(content: string): Promise<string[]> {
    const openai = new OpenAI({ apiKey: process.env.OPENAI_API_KEY });

    const completion = await openai.chat.completions.create({
      model: 'gpt-4o-mini', // ä½¿ç”¨è¼ƒä¾¿å®œçš„æ¨¡å‹
      messages: [
        {
          role: 'system',
          content: `ä½ æ˜¯ä¸€å€‹æ¨™ç±¤å»ºè­°å°ˆå®¶ã€‚åˆ†æå…§å®¹ä¸¦å»ºè­° 3-5 å€‹ç›¸é—œçš„ä¸­æ–‡æ¨™ç±¤ã€‚

å¸¸ç”¨æ¨™ç±¤é¡åˆ¥:
- ç‡Ÿé‹ç­–ç•¥ã€éŠ·å”®æŠ€å·§ã€äººäº‹ç®¡ç†ã€æŠ€è¡“æ–‡ä»¶
- è²¡å‹™åˆ†æã€å®¢æˆ¶é—œä¿‚ã€æ•™å­¸å“è³ªã€è¡ŒéŠ·æ¨å»£
- æ‹›å‹Ÿã€åŸ¹è¨“ã€KPIã€æµç¨‹ã€SOP

å›å‚³æ ¼å¼: åªå›å‚³æ¨™ç±¤,ç”¨é€—è™Ÿåˆ†éš”,ä¸è¦å…¶ä»–èªªæ˜ã€‚
ç¯„ä¾‹: æ‹›å‹Ÿ, closer, SOP, äººè³‡`
        },
        {
          role: 'user',
          content: `è«‹ç‚ºä»¥ä¸‹å…§å®¹å»ºè­°æ¨™ç±¤:\n\n${content.substring(0, 1000)}`
        }
      ],
      temperature: 0.5,
      max_tokens: 100
    });

    const tags = completion.choices[0].message.content
      .split(',')
      .map(tag => tag.trim())
      .filter(tag => tag.length > 0);

    return tags;
  }
  ```

#### 5.2 æ¨™ç±¤ API ç«¯é» (30 åˆ†é˜)
- [ ] å¯¦ä½œ `/api/know-it-all/tags/suggest`
- [ ] å¯¦ä½œ `/api/know-it-all/tags` (å–å¾—æ‰€æœ‰æ¨™ç±¤ + çµ±è¨ˆ)

---

### Phase 6: å‰ç«¯ä»‹é¢ - æ–‡ä»¶ç®¡ç† (2-3 å°æ™‚)

#### 6.1 æ–‡ä»¶ä¸Šå‚³å…ƒä»¶ (1.5 å°æ™‚)
- [ ] å‰µå»º `client/src/components/know-it-all/document-uploader.tsx`
- [ ] æ”¯æ´æ‹–æ”¾ä¸Šå‚³
- [ ] æ”¯æ´å¤šç¨®æ ¼å¼ (PDF, DOCX, MD, TXT)
- [ ] é¡¯ç¤ºä¸Šå‚³é€²åº¦
- [ ] ä¸Šå‚³å¾Œè‡ªå‹•å–å¾— AI æ¨™ç±¤å»ºè­°

#### 6.2 æ–‡ä»¶ç®¡ç†é é¢ (1.5 å°æ™‚)
- [ ] å‰µå»º `client/src/pages/tools/know-it-all/documents.tsx`
- [ ] åŠŸèƒ½:
  - [ ] æ–‡ä»¶åˆ—è¡¨ (å¡ç‰‡å¼é¡¯ç¤º)
  - [ ] æœå°‹èˆ‡éæ¿¾ (æ¨™ç±¤ã€åˆ†é¡)
  - [ ] æ–‡ä»¶é è¦½
  - [ ] ç·¨è¼¯/åˆªé™¤
  - [ ] æ‰¹æ¬¡æ“ä½œ

---

### Phase 7: å‰ç«¯ä»‹é¢ - å°è©±ç³»çµ± (3-4 å°æ™‚)

#### 7.1 å°è©±ä»‹é¢ä¸»å…ƒä»¶ (2 å°æ™‚)
- [ ] å‰µå»º `client/src/pages/tools/know-it-all/index.tsx`
- [ ] åƒè€ƒ `ai-chat-compact.tsx` çš„è¨­è¨ˆ
- [ ] å¸ƒå±€:
  ```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚             â”‚  ğŸ“ Know-it-all             â”‚
  â”‚  å°è©±åˆ—è¡¨   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚             â”‚                              â”‚
  â”‚  + æ–°å°è©±   â”‚                              â”‚
  â”‚             â”‚     å°è©±è¨Šæ¯å€åŸŸ              â”‚
  â”‚  ğŸ“ å°è©±1   â”‚                              â”‚
  â”‚  ğŸ“ å°è©±2   â”‚                              â”‚
  â”‚  ğŸ“ å°è©±3   â”‚                              â”‚
  â”‚             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚             â”‚  ğŸ’¬ è¼¸å…¥æ¡†                   â”‚
  â”‚             â”‚  [æ¨¡å‹é¸æ“‡] [ç™¼é€]           â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  ```

#### 7.2 è¨Šæ¯æ°£æ³¡å…ƒä»¶ (1 å°æ™‚)
- [ ] å‰µå»º `client/src/components/know-it-all/message-bubble.tsx`
- [ ] é¡¯ç¤º:
  - [ ] ç”¨æˆ¶/AI è¨Šæ¯ (ä¸åŒæ¨£å¼)
  - [ ] æ™‚é–“æˆ³è¨˜
  - [ ] Token ä½¿ç”¨é‡ (åƒ… AI è¨Šæ¯)
  - [ ] å¼•ç”¨ä¾†æºæ¨™ç±¤ (é»æ“Šå¯æŸ¥çœ‹æ–‡ä»¶)
  - [ ] æ“ä½œæŒ‰éˆ•:
    - [ ] ğŸ‘ æ¨™è¨˜æœ‰ç”¨
    - [ ] ğŸ“š åŠ å…¥çŸ¥è­˜åº«
    - [ ] ğŸ“‹ è¤‡è£½
    - [ ] ğŸ”„ é‡æ–°ç”Ÿæˆ

#### 7.3 è¨Šæ¯æ“ä½œå…ƒä»¶ (1 å°æ™‚)
- [ ] å‰µå»º `client/src/components/know-it-all/message-actions.tsx`
- [ ] æ¨™è¨˜ç‚ºæœ‰ç”¨çš„åŠŸèƒ½
- [ ] åŠ å…¥çŸ¥è­˜åº«çš„å½ˆçª—:
  - [ ] å¯ç·¨è¼¯è¨Šæ¯å…§å®¹
  - [ ] è¼¸å…¥æ¨™é¡Œ
  - [ ] é¸æ“‡/æ–°å¢æ¨™ç±¤
  - [ ] é¸æ“‡åˆ†é¡
  - [ ] é è¦½æœ€çµ‚æ–‡ä»¶

---

### Phase 8: é€²éšåŠŸèƒ½ (2-3 å°æ™‚)

#### 8.1 ä¾†æºå¼•ç”¨é¡¯ç¤º (1 å°æ™‚)
- [ ] å‰µå»º `client/src/components/know-it-all/source-citations.tsx`
- [ ] åœ¨ AI å›æ‡‰ä¸‹æ–¹é¡¯ç¤ºå¼•ç”¨çš„æ–‡ä»¶
- [ ] é»æ“Šå¯å±•é–‹æŸ¥çœ‹æ–‡ä»¶ç‰‡æ®µ
- [ ] é¡¯ç¤ºç›¸ä¼¼åº¦åˆ†æ•¸

#### 8.2 çµ±è¨ˆé é¢ (1 å°æ™‚)
- [ ] å‰µå»º `client/src/pages/tools/know-it-all/stats.tsx`
- [ ] é¡¯ç¤º:
  - [ ] ç¸½æ–‡ä»¶æ•¸
  - [ ] ç¸½å°è©±æ•¸
  - [ ] æœ¬æœˆå°è©±æ•¸
  - [ ] Token ä½¿ç”¨çµ±è¨ˆåœ–è¡¨
  - [ ] æˆæœ¬è¿½è¹¤
  - [ ] æœ€å¸¸ç”¨æ¨™ç±¤

#### 8.3 å°è©±æ­·å²é é¢ (1 å°æ™‚)
- [ ] å‰µå»º `client/src/pages/tools/know-it-all/conversations.tsx`
- [ ] åˆ—å‡ºæ‰€æœ‰å°è©±
- [ ] æœå°‹å°è©±å…§å®¹
- [ ] åŒ¯å‡ºå°è©± (Markdown æ ¼å¼)
- [ ] åˆªé™¤/æ­¸æª”å°è©±

---

### Phase 9: å°èˆªèˆ‡è·¯ç”± (30 åˆ†é˜)

#### 9.1 å‰ç«¯è·¯ç”± (15 åˆ†é˜)
- [ ] åœ¨ `client/src/App.tsx` åŠ å…¥è·¯ç”±:
  ```tsx
  const KnowItAll = lazy(() => import("@/pages/tools/know-it-all/index"));
  const KnowItAllDocuments = lazy(() => import("@/pages/tools/know-it-all/documents"));
  const KnowItAllStats = lazy(() => import("@/pages/tools/know-it-all/stats"));

  // åœ¨è·¯ç”±ä¸­åŠ å…¥
  <Route path="/tools/know-it-all">
    <ProtectedRoute>
      <KnowItAll />
    </ProtectedRoute>
  </Route>
  <Route path="/tools/know-it-all/documents">
    <ProtectedRoute>
      <KnowItAllDocuments />
    </ProtectedRoute>
  </Route>
  <Route path="/tools/know-it-all/stats">
    <ProtectedRoute>
      <KnowItAllStats />
    </ProtectedRoute>
  </Route>
  ```

#### 9.2 å°èˆªé¸å–® (15 åˆ†é˜)
- [ ] åœ¨å´é‚Šæ¬„ã€Œå·¥å…·ã€å€å¡ŠåŠ å…¥é€£çµ
- [ ] æ¢ä»¶é¡¯ç¤º (åƒ…å…è¨±çš„ç”¨æˆ¶å¯è¦‹):
  ```tsx
  {user?.email === 'xk4xk4563022@gmail.com' && (
    <NavLink to="/tools/know-it-all">
      ğŸ§  AI é¡§å•
    </NavLink>
  )}
  ```

---

### Phase 10: æ¸¬è©¦èˆ‡å„ªåŒ– (2-3 å°æ™‚)

#### 10.1 å¾Œç«¯æ¸¬è©¦ (1 å°æ™‚)
- [ ] å‰µå»º `tests/test-know-it-all.ts`
- [ ] æ¸¬è©¦é …ç›®:
  - [ ] æ–‡ä»¶ä¸Šå‚³èˆ‡è§£æ
  - [ ] Embedding ç”Ÿæˆ
  - [ ] èªç¾©æœå°‹
  - [ ] å°è©±æµç¨‹
  - [ ] æˆæœ¬è¨ˆç®—
  - [ ] æ¬Šé™æª¢æŸ¥

#### 10.2 å‰ç«¯æ¸¬è©¦ (1 å°æ™‚)
- [ ] æ¸¬è©¦å„ç¨®æ–‡ä»¶æ ¼å¼ä¸Šå‚³
- [ ] æ¸¬è©¦å°è©±æµç¨‹
- [ ] æ¸¬è©¦æ¨™è¨˜èˆ‡åŠ å…¥çŸ¥è­˜åº«
- [ ] æ¸¬è©¦æœå°‹èˆ‡éæ¿¾
- [ ] è¡Œå‹•è£ç½®éŸ¿æ‡‰å¼è¨­è¨ˆ

#### 10.3 æ•ˆèƒ½å„ªåŒ– (1 å°æ™‚)
- [ ] pgvector ç´¢å¼•å„ªåŒ–
- [ ] å°è©±æ­·å²åˆ†é è¼‰å…¥
- [ ] æ–‡ä»¶åˆ—è¡¨è™›æ“¬æ»¾å‹• (å¦‚æœæ–‡ä»¶å¾ˆå¤š)
- [ ] API å›æ‡‰å¿«å– (React Query)
- [ ] åœ–ç‰‡/å¤§æª”æ¡ˆ lazy loading

---

## ğŸ“Š æˆæœ¬ä¼°ç®—

### OpenAI API æˆæœ¬

#### GPT-5 å°è©±æˆæœ¬ (å‡è¨­ GPT-5 å®šåƒ¹é¡ä¼¼ GPT-4o)
- **è¼¸å…¥**: $0.005 / 1K tokens
- **è¼¸å‡º**: $0.015 / 1K tokens

**å–®æ¬¡å°è©±ä¼°ç®—**:
- çŸ¥è­˜æ–‡ä»¶ä¸Šä¸‹æ–‡: ~3,000 tokens
- å°è©±æ­·å²: ~1,000 tokens
- ç”¨æˆ¶å•é¡Œ: ~100 tokens
- **ç¸½è¼¸å…¥**: ~4,100 tokens â†’ $0.0205
- AI å›ç­”: ~500 tokens â†’ $0.0075
- **å–®æ¬¡æˆæœ¬**: ~$0.028 (ç´„ NT$0.85)

#### Embeddings æˆæœ¬
- **text-embedding-3-large**: $0.00013 / 1K tokens
- å¹³å‡æ–‡ä»¶: 2,000 tokens â†’ $0.00026 (å¹¾ä¹å¯å¿½ç•¥)

#### æ¨™ç±¤å»ºè­°æˆæœ¬
- **GPT-4o-mini**: $0.00015 / 1K tokens (è¼¸å…¥)
- å–®æ¬¡æ¨™ç±¤å»ºè­°: ~$0.0002 (å¯å¿½ç•¥)

### æœˆåº¦æˆæœ¬ä¼°ç®—

| ä½¿ç”¨æƒ…å¢ƒ | æ¯æ—¥å°è©±æ•¸ | æœˆå°è©±æ•¸ | æœˆæˆæœ¬ (USD) | æœˆæˆæœ¬ (TWD) |
|---------|-----------|---------|-------------|-------------|
| **è¼•åº¦ä½¿ç”¨** | 5 æ¬¡ | 150 æ¬¡ | $4.2 | ~NT$130 |
| **ä¸­åº¦ä½¿ç”¨** | 20 æ¬¡ | 600 æ¬¡ | $16.8 | ~NT$510 |
| **é‡åº¦ä½¿ç”¨** | 50 æ¬¡ | 1,500 æ¬¡ | $42 | ~NT$1,280 |
| **æ¥µé‡åº¦ä½¿ç”¨** | 100 æ¬¡ | 3,000 æ¬¡ | $84 | ~NT$2,560 |

**é¡å¤–æˆæœ¬**:
- Embeddings: æ¯æœˆç´„ $1-2 (100-200 å€‹æ–‡ä»¶)
- æ¨™ç±¤å»ºè­°: æ¯æœˆç´„ $0.5
- **ç¸½è¨ˆ**: æ¯”ä¸Šè¡¨å¤šç´„ NT$100

### å„²å­˜æˆæœ¬
- PostgreSQL å„²å­˜: å¹¾ä¹å…è²» (Supabase å…è²»æ–¹æ¡ˆ 500MB)
- ä¸Šå‚³æª”æ¡ˆå„²å­˜: å¯ä½¿ç”¨ Supabase Storage (å…è²»æ–¹æ¡ˆ 1GB)

---

## ğŸ” å®‰å…¨æ€§è€ƒé‡

### 1. è¨ªå•æ§åˆ¶
- âœ… **å¤šå±¤é˜²è­·**:
  1. å¾Œç«¯ middleware æª¢æŸ¥ (ä¸»è¦é˜²ç·š)
  2. å‰ç«¯è·¯ç”±å®ˆè¡› (è¼”åŠ©)
  3. UI æ¢ä»¶æ¸²æŸ“ (éš±è—å…¥å£)

### 2. è³‡æ–™éš”é›¢
- âœ… æ‰€æœ‰æŸ¥è©¢å¿…é ˆåŠ ä¸Š `created_by = user_id` æ¢ä»¶
- âœ… é˜²æ­¢è·¨ç”¨æˆ¶è³‡æ–™æ´©éœ² (é›–ç„¶ç›®å‰åªæœ‰ä¸€å€‹ç”¨æˆ¶)

### 3. è¼¸å…¥é©—è­‰
- âœ… æª”æ¡ˆé¡å‹ç™½åå–®: `['.pdf', '.docx', '.md', '.txt']`
- âœ… æª”æ¡ˆå¤§å°é™åˆ¶: 10MB
- âœ… å…§å®¹é•·åº¦é™åˆ¶: æœ€å¤š 100,000 å­—å…ƒ
- âœ… SQL Injection é˜²è­·: ä½¿ç”¨ parameterized queries

### 4. API é‡‘é‘°ä¿è­·
- âœ… OpenAI API Key å­˜åœ¨ç’°å¢ƒè®Šæ•¸
- âœ… ä¸åœ¨å‰ç«¯æš´éœ²
- âœ… å®šæœŸè¼ªæ› API Key

### 5. æˆæœ¬æ§åˆ¶
- âœ… å–®æ¬¡å°è©± token ä¸Šé™: 2,000 tokens (è¼¸å‡º)
- âœ… æ¯æ—¥å°è©±æ¬¡æ•¸é™åˆ¶: å¯é¸ (ä¾‹å¦‚ 100 æ¬¡/æ—¥)
- âœ… ç•°å¸¸ä½¿ç”¨è­¦å ±: æˆæœ¬è¶…éé–¾å€¼æ™‚ç™¼é€é€šçŸ¥

### 6. è³‡æ–™å‚™ä»½
- âœ… å®šæœŸå‚™ä»½çŸ¥è­˜åº«æ–‡ä»¶
- âœ… å°è©±è¨˜éŒ„å®šæœŸæ­¸æª”
- âœ… é‡è¦å°è©±æ¨™è¨˜å¾Œæ°¸ä¹…ä¿ç•™

---

## ğŸ¨ UI/UX è¨­è¨ˆå»ºè­°

### è‰²å½©ä¸»é¡Œ
- **ä¸»è‰²**: ç´«è‰²/è—è‰²æ¼¸å±¤ (è±¡å¾µæ™ºæ…§ã€ç§‘æŠ€)
- **å¼·èª¿è‰²**: é‡‘è‰² (è±¡å¾µçŸ¥è­˜çš„åƒ¹å€¼)
- **è¼”åŠ©è‰²**: ç°éš (ä¿æŒå°ˆæ¥­æ„Ÿ)

### åœ–ç¤ºç³»çµ±
- ğŸ§  Know-it-all ä¸»åœ–ç¤º
- ğŸ“š çŸ¥è­˜åº«/æ–‡ä»¶
- ğŸ’¬ å°è©±
- â­ å·²æ¨™è¨˜
- ğŸ·ï¸ æ¨™ç±¤
- ğŸ“Š çµ±è¨ˆ

### äº’å‹•åé¥‹
- âœ… **å³æ™‚å›æ‡‰**: æ‰“å­—å‹•ç•« (æ¨¡æ“¬ ChatGPT)
- âœ… **é€²åº¦æŒ‡ç¤º**: ä¸Šå‚³æ–‡ä»¶æ™‚é¡¯ç¤ºé€²åº¦æ¢
- âœ… **æˆåŠŸé€šçŸ¥**: Toast æç¤º (åŠ å…¥çŸ¥è­˜åº«æˆåŠŸç­‰)
- âœ… **éŒ¯èª¤è™•ç†**: å‹å–„çš„éŒ¯èª¤è¨Šæ¯

### éŸ¿æ‡‰å¼è¨­è¨ˆ
- **æ¡Œé¢**: å´é‚Šæ¬„ + ä¸»å…§å®¹å€ (å¦‚ä¸Šè¿°å¸ƒå±€)
- **å¹³æ¿**: å¯æ”¶åˆå´é‚Šæ¬„
- **æ‰‹æ©Ÿ**: å…¨è¢å¹•å°è©±,åº•éƒ¨å°èˆª

---

## ğŸš€ æœªä¾†æ“´å±•åŠŸèƒ½ (Phase 2)

### å„ªå…ˆç´š A (é«˜åƒ¹å€¼)
- [ ] **å¤šæ–‡ä»¶å°è©±**: é¸æ“‡ç‰¹å®šå¹¾å€‹æ–‡ä»¶é€²è¡Œå°è©±
- [ ] **å¼•ç”¨è¿½è¹¤**: æ¯å€‹å›ç­”æ¨™è¨»ä¾†æºæ®µè½
- [ ] **è‡ªå‹•æ‘˜è¦**: ä¸Šå‚³é•·æ–‡ä»¶è‡ªå‹•ç”Ÿæˆæ‘˜è¦
- [ ] **è³‡æ–™åº«æ•´åˆ**: ç›´æ¥æŸ¥è©¢å­¸å“¡/å ±è¡¨æ•¸æ“š

### å„ªå…ˆç´š B (æå‡é«”é©—)
- [ ] **èªéŸ³è¼¸å…¥**: ä½¿ç”¨ OpenAI Whisper API
- [ ] **åŒ¯å‡ºåŠŸèƒ½**: å°è©±åŒ¯å‡ºæˆ Markdown/PDF
- [ ] **çŸ¥è­˜åœ–è­œ**: è¦–è¦ºåŒ–æ–‡ä»¶é—œè¯
- [ ] **å”ä½œç­†è¨˜**: åœ¨å°è©±ä¸­åšç­†è¨˜

### å„ªå…ˆç´š C (éŒ¦ä¸Šæ·»èŠ±)
- [ ] **èªéŸ³è¼¸å‡º**: AI å›ç­”æœ—è®€
- [ ] **å¤šèªè¨€æ”¯æ´**: è‡ªå‹•ç¿»è­¯å¤–æ–‡æ–‡ä»¶
- [ ] **OCR**: æƒæä»¶æ–‡å­—è­˜åˆ¥
- [ ] **å®šæ™‚æ‘˜è¦**: æ¯é€±è‡ªå‹•ç”ŸæˆçŸ¥è­˜æ‘˜è¦éƒµä»¶

---

## ğŸ“š åƒè€ƒè³‡æº

### OpenAI API æ–‡ä»¶
- [GPT-5 API Reference](https://platform.openai.com/docs/api-reference/chat)
- [Embeddings Guide](https://platform.openai.com/docs/guides/embeddings)
- [Best Practices](https://platform.openai.com/docs/guides/prompt-engineering)

### pgvector æ–‡ä»¶
- [pgvector GitHub](https://github.com/pgvector/pgvector)
- [Supabase + pgvector Guide](https://supabase.com/docs/guides/ai/vector-columns)

### ç›¸é—œå°ˆæ¡ˆéˆæ„Ÿ
- [NotebookLM](https://notebooklm.google.com/) - Google çš„ AI ç­†è¨˜æœ¬
- [Obsidian + AI](https://obsidian.md/) - çŸ¥è­˜ç®¡ç†å·¥å…·
- [Mem.ai](https://get.mem.ai/) - AI çŸ¥è­˜åº«

---

## âœ… æª¢æŸ¥æ¸…å–®

é–‹å§‹é–‹ç™¼å‰çš„æº–å‚™:

### ç’°å¢ƒæª¢æŸ¥
- [ ] Node.js ç‰ˆæœ¬ >= 18
- [ ] PostgreSQL å¯è¨ªå•
- [ ] Supabase é€£ç·šæ­£å¸¸
- [ ] OpenAI API Key å·²è¨­ç½®
- [ ] pgvector extension å·²å®‰è£

### ä¾è³´å®‰è£
```bash
# å¾Œç«¯ä¾è³´
npm install openai pdf-parse mammoth cheerio axios multer @types/multer

# å‰ç«¯ä¾è³´ (å¯èƒ½å·²å®‰è£)
npm install react-markdown react-syntax-highlighter framer-motion
```

### ç’°å¢ƒè®Šæ•¸
```env
# .env æª”æ¡ˆ
OPENAI_API_KEY=sk-proj-xxxxx
SUPABASE_URL=https://xxxxx.supabase.co
SUPABASE_SERVICE_ROLE_KEY=xxxxx
```

---

## ğŸ“ é–‹ç™¼æ™‚çš„æ³¨æ„äº‹é …

1. **å…ˆå¾ MVP é–‹å§‹**
   - ç¬¬ä¸€ç‰ˆå…ˆåšæ ¸å¿ƒåŠŸèƒ½: æ–‡å­—ä¸Šå‚³ + å°è©±
   - ç¢ºä¿åŸºç¤åŠŸèƒ½ç©©å®šå¾Œå†åŠ é€²éšåŠŸèƒ½

2. **æ¸¬è©¦ GPT-5 API**
   - å…ˆç”¨ç°¡å–®çš„ API å‘¼å«æ¸¬è©¦ GPT-5 æ˜¯å¦æ­£å¸¸
   - ç¢ºèªè¨ˆè²»æ–¹å¼èˆ‡æˆæœ¬

3. **pgvector ç´¢å¼•**
   - å‘é‡ç´¢å¼•éœ€è¦æ™‚é–“å»ºç«‹ (å¤§é‡æ–‡ä»¶æ™‚)
   - å…ˆæ¸¬è©¦å°è¦æ¨¡ (10-20 å€‹æ–‡ä»¶)

4. **éŒ¯èª¤è™•ç†**
   - OpenAI API å¯èƒ½å¤±æ•— (rate limit, timeout)
   - æ–‡ä»¶è§£æå¯èƒ½å¤±æ•— (æ ¼å¼å•é¡Œ)
   - å‰ç«¯è¦æœ‰å‹å–„çš„éŒ¯èª¤æç¤º

5. **æˆæœ¬ç›£æ§**
   - å®šæœŸæª¢æŸ¥ OpenAI ä½¿ç”¨é‡
   - è¨­ç½®é ç®—è­¦å ±

---

## ğŸ“ çµèª

Know-it-all æ˜¯ä¸€å€‹å¼·å¤§çš„å€‹äºº AI é¡§å•ç³»çµ±,é€éæ•´åˆ GPT-5ã€èªç¾©æœå°‹ã€è‡ªå‹•æ¨™ç±¤ç­‰æŠ€è¡“,æ‰“é€ å‡ºä¸€å€‹èƒ½å¤ æŒçºŒæˆé•·çš„çŸ¥è­˜é«”ã€‚

**é è¨ˆé–‹ç™¼æ™‚é–“**: 12-16 å°æ™‚ (MVP ç‰ˆæœ¬)
**é è¨ˆæœˆæˆæœ¬**: NT$500-800 (ä¸­åº¦ä½¿ç”¨)
**æŠ€è¡“æŒ‘æˆ°åº¦**: ä¸­é«˜ (éœ€è¦ç†è§£å‘é‡æœå°‹ã€OpenAI API)

**é–‹å§‹é–‹ç™¼æ—¥æœŸ**: 2025-10-30
**é è¨ˆå®Œæˆæ—¥æœŸ**: 2025-10-31 or 2025-11-01

---

**ç¥é–‹ç™¼é †åˆ©!** ğŸš€

å¦‚æœ‰ä»»ä½•å•é¡Œ,å¯ä»¥éš¨æ™‚è©¢å• Claude Codeã€‚

---

*æœ¬æ–‡ä»¶ç”± Claude Code æ–¼ 2025-10-29 ç”Ÿæˆ*
*å°ˆæ¡ˆè² è²¬äºº: xk4xk4563022@gmail.com*
