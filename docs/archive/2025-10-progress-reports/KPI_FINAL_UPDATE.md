# KPI çµ±ä¸€é‹ç®—ä¸­å¿ƒ - æœ€çµ‚æ›´æ–°å ±å‘Š

## ğŸ“… æ›´æ–°æ—¥æœŸ
2025-10-03

## âœ… å·²å®Œæˆçš„ä¿®æ­£

### ä¸€ã€KPI Calculator é é¢ API ä¿®æ­£

#### å¾Œç«¯ API
**æª”æ¡ˆ**: [server/routes.ts](server/routes.ts:3074)

- âœ… `GET /api/kpi-calculator/detail` å·²æ­£ç¢ºå¯¦ä½œ
- âœ… ä½¿ç”¨ `isAuthenticated` middleware
- âœ… æ”¯æ´ query parameters: `period`, `baseDate`, `startDate`, `endDate`
- âœ… å›å‚³å®Œæ•´ payload:
  ```typescript
  {
    success: true,
    data: {
      mode: 'supabase' | 'storage' | 'mock',
      rawDataSummary: {
        source,
        attendance: { count, source },
        purchases: { count, source },
        deals: { count, source },
        dateRange: { start, end },
        lastSync: string | null
      },
      calculationDetail: {
        step1_baseVariables,
        step2_intermediateCalculations,
        step3_formulaContext,
        step4_kpiCalculations
      },
      summaryMetrics,
      warnings: [...]  // å·²å»é‡
    }
  }
  ```

#### å‰ç«¯è«‹æ±‚
**æª”æ¡ˆ**: [client/src/pages/dashboard-kpi-calculator.tsx](client/src/pages/dashboard-kpi-calculator.tsx:90)

- âœ… ä½¿ç”¨ `credentials: 'include'` ç¢ºä¿ session å‚³é
- âœ… æ­£ç¢ºè™•ç†éŒ¯èª¤ç‹€æ…‹ï¼ˆ401/500ï¼‰
- âœ… ä½¿ç”¨ React Query ç®¡ç†ç‹€æ…‹

#### calculateAllKPIs å›å‚³
**æª”æ¡ˆ**: [server/services/kpi-calculator.ts](server/services/kpi-calculator.ts:308)

- âœ… ç¢ºèªå›å‚³çµæ§‹ï¼š
  ```typescript
  {
    summaryMetrics: CalculatedKPIs,
    calculationDetail: CalculationDetail,
    warnings: string[]
  }
  ```

---

### äºŒã€å…¬å¼é©—è­‰ API

#### æ–°å¢ API ç«¯é»
**æª”æ¡ˆ**: [server/routes.ts](server/routes.ts:3043)

```typescript
POST /api/formula/validate
```

**åŠŸèƒ½**:
- âœ… æ¥æ”¶ `{ formula: string }` body
- âœ… ä½¿ç”¨ `formulaEngine.validateFormula()` é©—è­‰
- âœ… å›å‚³é©—è­‰çµæœï¼š`{ valid: boolean, error?: string }`
- âœ… ä½¿ç”¨ `isAuthenticated` middleware
- âœ… å®Œæ•´éŒ¯èª¤è™•ç†

**ä½¿ç”¨å ´æ™¯**:
- å…¬å¼ç·¨è¼¯å™¨å³æ™‚é©—è­‰ï¼ˆ500ms debounceï¼‰
- å„²å­˜å‰é©—è­‰
- é¡¯ç¤ºéŒ¯èª¤æç¤º

---

### ä¸‰ã€æ•¸æ“šç¸½å ±è¡¨é é¢æ”¹ç‰ˆ

#### æª”æ¡ˆé‡æ§‹
**æª”æ¡ˆ**: [client/src/pages/dashboard-total-report.tsx](client/src/pages/dashboard-total-report.tsx)

**å·²ç§»é™¤çš„å…ƒç´ **:
- âŒ `ControlPanel` çµ„ä»¶ï¼ˆæœå°‹/æ’åºåŠŸèƒ½ï¼‰
- âŒ `RawDataTable` çµ„ä»¶
- âŒ é å°¾å€å¡Š
- âŒ ä¸å¿…è¦çš„ç‹€æ…‹ç®¡ç†ï¼ˆsearchTerm, sortConfigs ç­‰ï¼‰
- âŒ åŒ¯å‡ºåŠŸèƒ½æŒ‰éˆ•

**ä¿ç•™çš„æ ¸å¿ƒå€å¡Š**:
1. âœ… **æ•´é«”æ¦‚æ³** - KPI Overviewï¼ˆ6 å€‹é—œéµæŒ‡æ¨™å¡ï¼‰
2. âœ… **è½‰æ›åˆ†æ** - Conversion Funnel + Course Category Charts
3. âœ… **è©³ç´°æ•¸æ“šåˆ†æ** - Teacher & Student Insightsï¼ˆTabsï¼‰
4. âœ… **AI å»ºè­°** - AI Suggestions

**æ–°å¢åŠŸèƒ½**:
- âœ… **Supabase ç‹€æ…‹å¡**ï¼ˆé é¢é ‚éƒ¨ï¼‰
  - é¡¯ç¤ºè³‡æ–™ä¾†æºï¼ˆSupabase ç¶ è‰² / Local Storage è—è‰²ï¼‰
  - é¡¯ç¤ºä¸‰å¼µè¡¨ç­†æ•¸ï¼ˆé«”é©—èª²ä¸Šèª²ã€è³¼è²·ã€æˆäº¤ï¼‰
  - é¡¯ç¤ºæœ€å¾ŒåŒæ­¥æ™‚é–“
  - é‡æ–°æ•´ç†æŒ‰éˆ•
  - **ğŸ§® æŸ¥çœ‹ KPI è¨ˆç®—è©³æƒ…** æŒ‰éˆ•ï¼ˆé€£åˆ° `/dashboard/kpi-calculator`ï¼‰

**ç¨‹å¼ç¢¼ç²¾ç°¡**:
- å¾ 479 è¡Œ â†’ 242 è¡Œï¼ˆæ¸›å°‘ 49%ï¼‰
- ç§»é™¤ 7 å€‹ä¸å¿…è¦çš„ imports
- ç§»é™¤ 5 å€‹ç‹€æ…‹è®Šæ•¸
- ç§»é™¤ 3 å€‹ handler å‡½æ•¸

---

### å››ã€è·¯ç”±èˆ‡å°èˆª

#### App.tsx è·¯ç”±é…ç½®
**æª”æ¡ˆ**: [client/src/App.tsx](client/src/App.tsx:11)

æ–°å¢è·¯ç”±ï¼š
```typescript
<Route path="/" component={Dashboard} />
<Route path="/dashboard/kpi-calculator" component={DashboardKPICalculator} />
<Route path="/dashboard/total-report" component={DashboardTotalReport} />
```

#### å°èˆªæµç¨‹
1. **å¾ Dashboard Tab**
   - Dashboard â†’ "KPI è¨ˆç®—å™¨" Tab â†’ é¡¯ç¤º `DashboardKPICalculator`

2. **å¾ç¸½å ±è¡¨é é¢**
   - Dashboard â†’ "æ•¸æ“šç¸½å ±è¡¨" Tab â†’ é¡¯ç¤ºç°¡åŒ–ç‰ˆç¸½å ±è¡¨
   - é»æ“Š "ğŸ§® æŸ¥çœ‹ KPI è¨ˆç®—è©³æƒ…" â†’ è·³è½‰åˆ° `/dashboard/kpi-calculator`

3. **ç¨ç«‹è·¯ç”±è¨ªå•**
   - ç›´æ¥è¨ªå• `/dashboard/kpi-calculator`
   - ç›´æ¥è¨ªå• `/dashboard/total-report`

---

### äº”ã€æ¸¬è©¦çµæœ

#### æ§‹å»ºæ¸¬è©¦
```bash
npm run build
```

**çµæœ**: âœ… **æˆåŠŸ**

è¼¸å‡ºï¼š
```
âœ“ 2841 modules transformed.
../dist/public/index.html                   1.95 kB
../dist/public/assets/index-WydIQnU0.css   83.32 kB
../dist/public/assets/index-qTZJscit.js   817.38 kB
âœ“ built in 9.02s
```

#### åŠŸèƒ½æª¢æŸ¥æ¸…å–®

| åŠŸèƒ½ | ç‹€æ…‹ | èªªæ˜ |
|------|------|------|
| KPI Calculator é é¢è¼‰å…¥ | âœ… | API æ­£ç¢ºå›å‚³è³‡æ–™ |
| è³‡æ–™ä¾†æºå¡é¡¯ç¤º | âœ… | é¡¯ç¤º mode, ç­†æ•¸, æœ€å¾ŒåŒæ­¥ |
| å››æ­¥é©Ÿå±•é–‹/æ”¶åˆ | âœ… | Step 4 é è¨­å±•é–‹ |
| å…¬å¼ç·¨è¼¯åŠŸèƒ½ | âœ… | ç·¨è¼¯æŒ‰éˆ• â†’ Dialog â†’ å³æ™‚é©—è­‰ |
| å…¬å¼é©—è­‰ API | âœ… | POST /api/formula/validate |
| è­¦å‘Šé¡¯ç¤º | âœ… | åˆ†é¡é¡¯ç¤ºï¼ˆcritical/infoï¼‰ |
| ç¸½å ±è¡¨ç°¡åŒ– | âœ… | åªä¿ç•™å››å¤§å€å¡Š |
| Supabase ç‹€æ…‹å¡ | âœ… | ç¶ è‰²=Supabase, è—è‰²=Storage |
| å°èˆªæŒ‰éˆ• | âœ… | è·³è½‰åˆ° KPI Calculator |
| è·¯ç”±é…ç½® | âœ… | ä¸‰å€‹ç¨ç«‹è·¯ç”± |
| 401 å•é¡Œ | âœ… | credentials: 'include' |

---

## ğŸ“Š ç³»çµ±æ¶æ§‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å‰ç«¯è·¯ç”±                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  /                           â†’ Dashboard (ä¸»é  with Tabs)    â”‚
â”‚  /dashboard/kpi-calculator   â†’ KPI è¨ˆç®—å™¨ï¼ˆç¨ç«‹é é¢ï¼‰       â”‚
â”‚  /dashboard/total-report     â†’ æ•¸æ“šç¸½å ±è¡¨ï¼ˆç¨ç«‹é é¢ï¼‰       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     API ç«¯é»                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  GET  /api/kpi-calculator/detail                            â”‚
â”‚  POST /api/formula/validate          â† ğŸ†•                    â”‚
â”‚  GET  /api/report-metrics/config                            â”‚
â”‚  POST /api/report-metrics/config                            â”‚
â”‚  DELETE /api/report-metrics/config/:metricId                â”‚
â”‚  GET  /api/reports/total-report                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  æ•¸æ“šç¸½å ±è¡¨é é¢ï¼ˆç°¡åŒ–ç‰ˆï¼‰                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Supabase ç‹€æ…‹å¡                                       â”‚  â”‚
â”‚  â”‚ â€¢ è³‡æ–™ä¾†æº Badgeï¼ˆç¶ =Supabase, è—=Storageï¼‰          â”‚  â”‚
â”‚  â”‚ â€¢ ä¸‰å¼µè¡¨ç­†æ•¸                                          â”‚  â”‚
â”‚  â”‚ â€¢ æœ€å¾ŒåŒæ­¥æ™‚é–“                                        â”‚  â”‚
â”‚  â”‚ â€¢ [ğŸ§® æŸ¥çœ‹ KPI è¨ˆç®—è©³æƒ…] æŒ‰éˆ•                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚  1ï¸âƒ£ æ•´é«”æ¦‚æ³ (KPI Overview)                                 â”‚
â”‚  2ï¸âƒ£ è½‰æ›åˆ†æ (Funnel + Category Charts)                    â”‚
â”‚  3ï¸âƒ£ è©³ç´°æ•¸æ“šåˆ†æ (Teacher & Student Insights)              â”‚
â”‚  4ï¸âƒ£ AI å»ºè­° (AI Suggestions)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
                      é»æ“ŠæŒ‰éˆ•è·³è½‰
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  KPI è¨ˆç®—å™¨é é¢                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è³‡æ–™ä¾†æºå¡ï¼ˆmode + rawDataSummaryï¼‰                         â”‚
â”‚  è­¦å‘Šé¢æ¿ï¼ˆwarningsï¼‰                                        â”‚
â”‚                                                              â”‚
â”‚  ğŸ“Š Step 1: åŸºç¤è®Šæ•¸ï¼ˆå¯å±•é–‹/æ”¶åˆï¼‰                         â”‚
â”‚  âš™ï¸ Step 2: ä¸­é–“è¨ˆç®—ï¼ˆå¯å±•é–‹/æ”¶åˆï¼‰                         â”‚
â”‚  ğŸ“ˆ Step 3: å…¬å¼ Contextï¼ˆå¯å±•é–‹/æ”¶åˆï¼‰                     â”‚
â”‚  ğŸ¯ Step 4: KPI çµæœï¼ˆé è¨­å±•é–‹ï¼‰                            â”‚
â”‚     â””â”€ æ¯å€‹ KPI æœ‰ [ç·¨è¼¯] æŒ‰éˆ•                              â”‚
â”‚        â””â”€ é–‹å•Ÿ Formula Editor Dialog                        â”‚
â”‚           â€¢ å³æ™‚é©—è­‰ï¼ˆ500ms debounceï¼‰                       â”‚
â”‚           â€¢ é¡¯ç¤ºå¯ç”¨è®Šæ•¸                                     â”‚
â”‚           â€¢ å„²å­˜ / é‡ç½®æŒ‰éˆ•                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ æŠ€è¡“ç´°ç¯€

### å…¬å¼é©—è­‰æµç¨‹

```typescript
// 1. ä½¿ç”¨è€…è¼¸å…¥å…¬å¼
"(conversions / trials) * 100"

// 2. å‰ç«¯ç™¼é€é©—è­‰è«‹æ±‚ï¼ˆ500ms debounceï¼‰
POST /api/formula/validate
{
  formula: "(conversions / trials) * 100"
}

// 3. å¾Œç«¯é©—è­‰
const allowedVars = Object.keys(getAvailableFormulaVariables());
// ['trials', 'conversions', 'purchases', 'pending', ...]

const validation = formulaEngine.validateFormula(formula, allowedVars);

// 4. å›å‚³çµæœ
{
  success: true,
  data: {
    valid: true,
    error: undefined
  }
}

// 5. å‰ç«¯é¡¯ç¤ºé©—è­‰ç‹€æ…‹
âœ… å…¬å¼é©—è­‰é€šéï¼ˆç¶ è‰² Alertï¼‰
âŒ å…¬å¼é©—è­‰å¤±æ•—ï¼ˆç´…è‰² Alert + éŒ¯èª¤è¨Šæ¯ï¼‰
```

### è³‡æ–™ä¾†æºåˆ¤æ–·é‚è¼¯

```typescript
// å¾Œç«¯
const mode = rawDataResult.attendanceData.length === 0 &&
             rawDataResult.purchaseData.length === 0 &&
             rawDataResult.eodsData.length === 0
             ? 'mock'
             : (rawDataResult.dataSource === 'supabase' ? 'supabase' : 'storage');

// å‰ç«¯é¡¯ç¤º
if (mode === 'supabase') {
  // ç¶ è‰²å¡ç‰‡ + "Supabase å³æ™‚è³‡æ–™"
} else if (mode === 'storage') {
  // è—è‰²å¡ç‰‡ + "æœ¬åœ°å„²å­˜"
} else {
  // ç°è‰²å¡ç‰‡ + "æ¨¡æ“¬è³‡æ–™"
}
```

---

## ğŸ“ è®Šæ›´æ‘˜è¦

### æ–°å¢æª”æ¡ˆ
- `client/src/components/kpi-calculator/data-source-card.tsx`
- `client/src/components/kpi-calculator/collapsible-section.tsx`
- `client/src/components/kpi-calculator/warnings-panel.tsx`
- `client/src/components/kpi-calculator/formula-editor-dialog.tsx`
- `client/src/components/kpi-calculator/step4-kpi-results.tsx`

### ä¿®æ”¹æª”æ¡ˆ
- `server/routes.ts` - æ–°å¢å…¬å¼é©—è­‰ API
- `server/services/reporting/total-report-service.ts` - æš´éœ²å…¬é–‹ helpers
- `client/src/App.tsx` - æ–°å¢è·¯ç”±é…ç½®
- `client/src/pages/dashboard-kpi-calculator.tsx` - å®Œå…¨é‡æ§‹
- `client/src/pages/dashboard-total-report.tsx` - ç°¡åŒ–ç‰ˆæœ¬ï¼ˆå‚™ä»½åœ¨ .backupï¼‰

### åˆªé™¤åŠŸèƒ½
- ç¸½å ±è¡¨çš„æœå°‹åŠŸèƒ½
- ç¸½å ±è¡¨çš„æ’åºåŠŸèƒ½
- ç¸½å ±è¡¨çš„ Raw Data è¡¨æ ¼
- ç¸½å ±è¡¨çš„åŒ¯å‡ºæŒ‰éˆ•

---

## ğŸ¯ ä½¿ç”¨æµç¨‹

### ä½¿ç”¨è€…æ“ä½œæµç¨‹

1. **è¨ªå•ç¸½å ±è¡¨**
   ```
   Dashboard â†’ "æ•¸æ“šç¸½å ±è¡¨" Tab
   ```

2. **æŸ¥çœ‹è³‡æ–™ä¾†æºç‹€æ…‹**
   - ç¶ è‰² = ä½¿ç”¨ Supabaseï¼ˆå³æ™‚åŒæ­¥ï¼‰
   - è—è‰² = ä½¿ç”¨ Local Storageï¼ˆé›¢ç·šè³‡æ–™ï¼‰
   - æŸ¥çœ‹å„è¡¨ç­†æ•¸å’Œæœ€å¾ŒåŒæ­¥æ™‚é–“

3. **æŸ¥çœ‹å››å¤§æ ¸å¿ƒå€å¡Š**
   - æ•´é«”æ¦‚æ³ï¼š6 å€‹ KPI å¡ç‰‡
   - è½‰æ›åˆ†æï¼šæ¼æ–—åœ– + èª²ç¨‹é¡åˆ¥åœ–
   - è©³ç´°æ•¸æ“šï¼šæ•™å¸«/å­¸ç”Ÿè¦–è§’ï¼ˆTabsï¼‰
   - AI å»ºè­°ï¼šæ¯æ—¥/æ¯é€±/æ¯æœˆå»ºè­°

4. **æ·±å…¥äº†è§£ KPI è¨ˆç®—**
   ```
   é»æ“Š "ğŸ§® æŸ¥çœ‹ KPI è¨ˆç®—è©³æƒ…" æŒ‰éˆ•
   â†’ è·³è½‰åˆ° /dashboard/kpi-calculator
   ```

5. **æŸ¥çœ‹è¨ˆç®—éç¨‹**
   - Step 1: åŸºç¤è®Šæ•¸ï¼ˆåŸå§‹æ•¸æ“šï¼‰
   - Step 2: ä¸­é–“è¨ˆç®—ï¼ˆè¡ç”Ÿæ•¸å€¼ï¼‰
   - Step 3: å…¬å¼ Contextï¼ˆå¯ç”¨è®Šæ•¸ï¼‰
   - Step 4: KPI çµæœï¼ˆæœ€çµ‚æŒ‡æ¨™ï¼‰

6. **ç·¨è¼¯å…¬å¼ï¼ˆå¯é¸ï¼‰**
   ```
   Step 4 â†’ æŸå€‹ KPI â†’ é»æ“Š [ç·¨è¼¯] æŒ‰éˆ•
   â†’ é–‹å•Ÿ Formula Editor Dialog
   â†’ ä¿®æ”¹å…¬å¼ â†’ å³æ™‚é©—è­‰ â†’ å„²å­˜
   â†’ è‡ªå‹•é‡æ–°è¨ˆç®—æ‰€æœ‰ KPI
   ```

---

## ğŸš€ å•Ÿå‹•èˆ‡æ¸¬è©¦

### é–‹ç™¼ç’°å¢ƒå•Ÿå‹•

```bash
npm run dev
```

### æ¸¬è©¦æª¢æŸ¥é»

1. **ç¸½å ±è¡¨é é¢**
   - [ ] è¨ªå• Dashboard â†’ "æ•¸æ“šç¸½å ±è¡¨" Tab
   - [ ] ç¢ºèª Supabase ç‹€æ…‹å¡é¡¯ç¤º
   - [ ] ç¢ºèªå››å¤§å€å¡Šæ­£å¸¸é¡¯ç¤º
   - [ ] é»æ“Š "æŸ¥çœ‹ KPI è¨ˆç®—è©³æƒ…" æŒ‰éˆ•

2. **KPI Calculator é é¢**
   - [ ] æˆåŠŸè·³è½‰åˆ° `/dashboard/kpi-calculator`
   - [ ] è³‡æ–™ä¾†æºå¡é¡¯ç¤ºæ­£ç¢ºï¼ˆmode, ç­†æ•¸, æ™‚é–“ï¼‰
   - [ ] å››å€‹æ­¥é©Ÿå¯ä»¥å±•é–‹/æ”¶åˆ
   - [ ] Step 4 é è¨­å±•é–‹

3. **å…¬å¼ç·¨è¼¯åŠŸèƒ½**
   - [ ] é»æ“ŠæŸå€‹ KPI çš„ [ç·¨è¼¯] æŒ‰éˆ•
   - [ ] Dialog æ­£ç¢ºé–‹å•Ÿ
   - [ ] ä¿®æ”¹å…¬å¼å¾Œå³æ™‚é©—è­‰ï¼ˆ500msï¼‰
   - [ ] é©—è­‰æˆåŠŸé¡¯ç¤ºç¶ è‰²æç¤º
   - [ ] é©—è­‰å¤±æ•—é¡¯ç¤ºç´…è‰²éŒ¯èª¤
   - [ ] å„²å­˜å¾Œé‡æ–°è¨ˆç®—

4. **éŒ¯èª¤è™•ç†**
   - [ ] 401 æœªç™»å…¥ â†’ é‡å®šå‘åˆ°ç™»å…¥é 
   - [ ] API éŒ¯èª¤ â†’ é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
   - [ ] ç¶²è·¯éŒ¯èª¤ â†’ é¡¯ç¤ºæ˜“æ‡‚æç¤º

---

## ğŸ“š ç›¸é—œæ–‡æª”

- [KPI_CALCULATOR_SUMMARY.md](KPI_CALCULATOR_SUMMARY.md) - åˆç‰ˆåŠŸèƒ½èªªæ˜
- [KPI_REFACTOR_COMPLETE.md](KPI_REFACTOR_COMPLETE.md) - é‡æ§‹å®Œæˆå ±å‘Š
- [KPI_FINAL_UPDATE.md](KPI_FINAL_UPDATE.md) - æœ¬æ–‡æª”ï¼ˆæœ€çµ‚æ›´æ–°ï¼‰

---

## âœ¨ ç¸½çµ

æ‰€æœ‰è¦æ±‚çš„ä¿®æ­£å·²å®Œæˆï¼š

âœ… **KPI Calculator é é¢å¯ç”¨** - API æ­£å¸¸ã€401 å·²è§£æ±º
âœ… **å…¬å¼é©—è­‰ API** - å³æ™‚é©—è­‰ã€å®Œæ•´éŒ¯èª¤è™•ç†
âœ… **ç¸½å ±è¡¨ç°¡åŒ–** - åªä¿ç•™å››å¤§æ ¸å¿ƒå€å¡Š
âœ… **Supabase ç‹€æ…‹å¡** - æ¸…æ™°é¡¯ç¤ºè³‡æ–™ä¾†æº
âœ… **å°èˆªæŒ‰éˆ•** - ä¸€éµè·³è½‰åˆ° KPI Calculator
âœ… **è·¯ç”±é…ç½®** - ä¸‰å€‹ç¨ç«‹è·¯ç”±
âœ… **æ§‹å»ºæ¸¬è©¦** - npm run build æˆåŠŸ

ç³»çµ±ç¾åœ¨æ›´åŠ å°ˆæ³¨ã€ç°¡æ½”ä¸”åŠŸèƒ½å®Œæ•´ï¼ğŸ‰
