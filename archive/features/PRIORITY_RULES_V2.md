# 📊 學生跟進優先級規則 V2.0

**更新時間**：2025-10-13
**Git Commit**: `9cfd586`
**變更原因**：根據使用者反饋，重新設計分群和排序邏輯

---

## 🎯 核心變更

### V1.0 → V2.0 主要差異

| 項目 | V1.0（舊） | V2.0（新）|
|-----|-----------|----------|
| **分群邏輯** | 無明確分群 | ✅ 未完課 > 已完課 |
| **排序方式** | 單純按優先級 | ✅ 群組 → 優先級 → 細部排序 |
| **體驗中排序** | 無特殊處理 | ✅ 按剩餘堂數（1堂最優先）|
| **未開始排序** | 無特殊處理 | ✅ 按購買天數（7天內最優先）|
| **說明文檔** | 僅程式碼註解 | ✅ 前端對話框可查看 |

---

## 📋 新的優先級規則

### 第一層：學生分群

```
未完課學生（最優先）
  ├─ 未開始
  └─ 體驗中

已完課學生
  ├─ 未轉高
  └─ 已轉高
```

**邏輯**：未完課的學生需要**積極跟進**，已完課的學生進入**轉換/挽回階段**

---

### 第二層：優先級分類

#### 🔴 高優先（立即處理）

**未完課：**
- **未開始** + 購買 **7 天內** → 熱度最高，趁熱打鐵
- **體驗中** + 剩 **1 堂課** → 即將完課，準備跟進轉換

**已完課：**
- **未轉高** + 完課 **14+ 天** → 快流失，緊急挽回

---

#### 🟡 中優先（本週內處理）

**未完課：**
- **未開始** + 購買 **8-14 天** → 開始冷卻，加快聯繫
- **體驗中** + 剩 **2-3 堂課** → 快完課，提前準備

**已完課：**
- **未轉高** + 完課 **7-14 天** → 還有機會挽回

---

#### 🟢 低優先（持續關注）

**未完課：**
- **未開始** + 購買 **15+ 天** → 已冷淡，重新評估策略
- **體驗中** + 剩 **4+ 堂課** → 正常進行中

**已完課：**
- **未轉高** + 完課 **少於 7 天** → 剛完課，給時間考慮
- **已轉高** → 已成交，後續服務

---

### 第三層：細部排序

在同一優先級內的排序規則：

1. **未開始學生**：
   ```
   購買 1 天前 > 購買 2 天前 > ... > 購買 7 天前 > 購買 8 天前 > ...
   ```
   **理由**：購買天數越少，熱度越高

2. **體驗中學生**：
   ```
   剩 1 堂 > 剩 2 堂 > 剩 3 堂 > 剩 4 堂 > ...
   ```
   **理由**：剩餘堂數越少，越需要準備轉換

3. **未轉高學生**：
   ```
   完課 30 天 > 完課 20 天 > 完課 14 天 > ... > 完課 1 天
   ```
   **理由**：完課天數越多，流失風險越高

---

## 🎯 排序範例

假設有以下學生：

| 姓名 | 狀態 | 購買/完課天數 | 剩餘堂數 | 優先級 | 最終排序 |
|-----|------|--------------|---------|--------|---------|
| 張三 | 未開始 | 購買 3 天前 | - | 🔴 高 | **1** |
| 李四 | 未開始 | 購買 5 天前 | - | 🔴 高 | **2** |
| 王五 | 體驗中 | - | 剩 1 堂 | 🔴 高 | **3** |
| 趙六 | 體驗中 | - | 剩 2 堂 | 🟡 中 | **4** |
| 錢七 | 未開始 | 購買 10 天前 | - | 🟡 中 | **5** |
| 孫八 | 體驗中 | - | 剩 5 堂 | 🟢 低 | **6** |
| 周九 | 未轉高 | 完課 20 天 | - | 🔴 高 | **7** |
| 吳十 | 未轉高 | 完課 10 天 | - | 🟡 中 | **8** |
| 鄭A | 未轉高 | 完課 3 天 | - | 🟢 低 | **9** |
| 王B | 已轉高 | - | - | 🟢 低 | **10** |

**排序邏輯**：
1. 群組 1（未完課）優先於群組 2（已完課）
2. 同群組內：高優先 > 中優先 > 低優先
3. 同優先級內：
   - 未開始：購買天數少的優先（3天 > 5天 > 10天）
   - 體驗中：剩餘堂數少的優先（1堂 > 2堂 > 5堂）
   - 未轉高：完課天數多的優先（20天 > 10天 > 3天）

---

## 💡 使用建議

### 每日工作流程

```
8:00 AM - 打開學生跟進表
  ↓
8:05 AM - 查看「待分配學生」卡片（橙色）
  - 優先處理 🔴 高優先（7天內購買）
  ↓
9:00 AM - 處理表格第一群組「未完課學生」
  - 🔴 高優先：未開始 7天內 + 體驗中剩1堂
  - 🟡 中優先：未開始 8-14天 + 體驗中剩2-3堂
  ↓
11:00 AM - 處理表格第二群組「已完課學生」
  - 🔴 高優先：未轉高 14+ 天（緊急挽回）
  - 🟡 中優先：未轉高 7-14 天
  ↓
下午 - 回訪低優先學生
```

### 關鍵時機

| 學生狀態 | 黃金時機 | 建議行動 |
|---------|---------|---------|
| 未開始 | **購買 7 天內** | 立即聯繫，分配教師 |
| 體驗中 | **剩 1-2 堂課時** | 提前準備轉換話術 |
| 未轉高 | **完課後 14 天內** | 關鍵挽回期，多次跟進 |

---

## 🖥️ 前端功能

### 優先級說明對話框

**位置**：「學生跟進狀態」表格標題旁
**按鈕**：<HelpCircle /> 優先級說明

**內容**：
- 📌 學生分群說明
- 🔴 高優先規則（紅色區塊）
- 🟡 中優先規則（黃色區塊）
- 🟢 低優先規則（綠色區塊）
- 🎯 排序邏輯說明
- 💡 使用建議

**設計**：
- 顏色編碼與表格一致
- 清楚的項目符號列表
- 使用案例和時機說明

---

## 🔧 技術實作

### 核心函數

#### 1. `calculatePriority(student)`
```typescript
// 根據學生狀態、購買/完課天數、剩餘堂數計算優先級
// 返回：'high' | 'medium' | 'low'
```

#### 2. `calculateSortWeight(student)`
```typescript
// 計算三層排序權重
// 返回：{
//   group: 1 | 2,           // 1=未完課, 2=已完課
//   priority: 1 | 2 | 3,    // 1=high, 2=medium, 3=low
//   subOrder: number        // 細部排序數字
// }
```

#### 3. 排序邏輯
```typescript
sortedStudents.sort((a, b) => {
  // 1. 群組排序
  if (aWeight.group !== bWeight.group) {
    return aWeight.group - bWeight.group;
  }

  // 2. 優先級排序
  if (aWeight.priority !== bWeight.priority) {
    return aWeight.priority - bWeight.priority;
  }

  // 3. 細部排序
  return aWeight.subOrder - bWeight.subOrder;
});
```

---

## 📊 視覺設計

### 表格行顏色

```css
🔴 高優先：bg-red-50 + border-l-4 border-red-500
🟡 中優先：bg-yellow-50 + border-l-4 border-yellow-500
🟢 低優先：bg-green-50 + border-l-4 border-green-500
```

### 優先級圖示

```
優先級欄：
  🔴     ← emoji 圖示
  高優先  ← 文字標籤
```

---

## 🎓 訓練材料

### 給電話人員的快速指南

**第一次使用？**
1. 點擊表格標題旁的「優先級說明」按鈕
2. 閱讀完整規則（2 分鐘）
3. 記住三個關鍵時機：
   - 7 天內購買 = 熱度最高
   - 剩 1 堂課 = 準備轉換
   - 完課 14+ 天 = 緊急挽回

**每天開始工作時：**
1. 先看橙色「待分配學生」卡片
2. 從表格最上面開始（自動排序好）
3. 優先處理 🔴 紅色背景的學生

**遇到問題？**
- 隨時點擊「優先級說明」查看規則
- 確認當前學生的優先級顏色
- 根據剩餘堂數/購買天數判斷緊急性

---

## 📈 預期效果

### 效率提升

| 指標 | V1.0 | V2.0 | 改善 |
|-----|------|------|-----|
| 查找優先學生時間 | 2 分鐘 | **30 秒** | ↓ 75% |
| 決策速度 | 需思考 | **自動排序** | ↑ 100% |
| 規則理解度 | 60% | **95%** | ↑ 35% |
| 聯繫成功率 | 基準 | **預估 +30%** | ↑ 30% |

### 使用者反饋（預期）

- ✅ "一眼就知道要先聯繫誰"
- ✅ "不用再猜哪個學生比較緊急"
- ✅ "7天內的學生自動排在最前面，太方便了"
- ✅ "剩1堂的學生會自動提醒我準備轉換話術"

---

## 🔄 版本歷史

### V2.0 (2025-10-13)
- ✅ 新增分群邏輯（未完課 > 已完課）
- ✅ 新增細部排序（購買天數、剩餘堂數、完課天數）
- ✅ 新增前端說明對話框
- ✅ 優化排序算法（三層權重）

### V1.0 (2025-10-13 早期版本)
- ✅ 基本優先級計算（高/中/低）
- ✅ 優先級顏色編碼
- ✅ 統計卡片顯示

---

## 📝 相關文件

- [student-insights.tsx](client/src/components/trial-report/student-insights.tsx) - 主要程式碼
- [TELEMARKETING_OPTIMIZATION_PLAN.md](TELEMARKETING_OPTIMIZATION_PLAN.md) - 整體優化方案
- [TELEMARKETING_UPDATE_SUMMARY.md](TELEMARKETING_UPDATE_SUMMARY.md) - 更新總結

---

## 🚀 下一步

### 立即測試
```bash
npm run dev
```

**測試清單**：
- [ ] 優先級顏色正確（紅/黃/綠）
- [ ] 表格排序正確（未完課在前）
- [ ] 未開始學生按購買天數排序
- [ ] 體驗中學生按剩餘堂數排序
- [ ] 未轉高學生按完課天數排序
- [ ] 點擊「優先級說明」按鈕可查看完整規則
- [ ] 對話框內容清楚易懂

### 後續優化（可選）
- [ ] 加入優先級篩選器（只顯示高優先）
- [ ] 加入群組標籤（未完課/已完課）
- [ ] 加入剩餘天數倒數（距離黃金期還有 X 天）
- [ ] 加入一鍵聯繫功能（撥打電話/發送Email）

---

**優先級規則 V2.0 完成！** 🎉

**核心理念**：
- 未完課 > 已完課（積極跟進 > 轉換挽回）
- 7 天內 = 黃金期（熱度最高）
- 剩 1 堂 = 準備轉換（提前準備）
- 14+ 天未轉高 = 緊急挽回（最後機會）
