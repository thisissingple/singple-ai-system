# 📞 電話人員體驗課跟進表優化方案

## 🎯 使用場景
**目標使用者**：電話人員（Telemarketing）
**主要任務**：
1. 聯繫未開始體驗課的學生，幫忙對接教師
2. 追蹤體驗中的學生進度
3. 跟進未轉高的學生

---

## 📊 當前資料結構分析

### 「未知教師」= 「未開始學生」
**資料來源邏輯** ([total-report-service.ts:891](server/services/reporting/total-report-service.ts#L891))：
```typescript
teacherName: student.teacherName || '未知教師',
```

**學生分類：**
1. **未開始學生（未知教師）**
   - ✅ 有購買記錄
   - ❌ 沒有上課記錄
   - ❌ 沒有 `lastClassDate`
   - 狀態：「未開始」

2. **體驗中學生**
   - ✅ 有購買記錄
   - ✅ 有上課記錄
   - ✅ 有教師名稱
   - ✅ 有 `lastClassDate`
   - 剩餘堂數 > 0

3. **未轉高學生**
   - ✅ 完成所有體驗課
   - ❌ 沒有購買高階方案
   - 需要追蹤

---

## 🎨 UI 優化方案

### 優化 1: 修正「未知教師」顯示
**改為「未開始學生」專區**

```tsx
// 目前
老師待跟進統計：
  未知教師: 27

// 改為
📋 待分配教師：
  未開始學生: 27  [立即分配]
```

---

### 優化 2: 新增電話撥打專用欄位

**表格新增欄位：**
| 學生姓名 | Email | **電話** | **購買日期** | 方案 | 狀態 | **上次聯繫** | **下次行動** | **快速操作** |
|---------|------|---------|------------|-----|-----|------------|------------|------------|
| 張三 | test@email.com | **0912-345-678** | **2025-10-01** | 8堂體驗課 | 未開始 | **—** | **需聯繫** | **[撥打電話]** |

**新增欄位說明：**
- **電話**：學生聯絡電話（需從購買記錄取得）
- **購買日期**：體驗課購買日期（判斷緊急性）
- **上次聯繫**：最後一次電話聯繫日期
- **下次行動**：系統建議的下一步
- **快速操作**：撥打電話、記錄備註、分配教師

---

### 優化 3: 優先級排序

**自動計算優先級：**
```typescript
優先級 =
  - 購買日期超過 7 天未聯繫：🔴 高優先
  - 購買日期 3-7 天：🟡 中優先
  - 購買日期 < 3 天：🟢 低優先

  - 未轉高超過 14 天：🔴 高優先
  - 體驗中剩餘 1 堂：🟡 中優先
```

**表格預設排序：**
1. 優先級（高→低）
2. 購買日期（舊→新）

---

### 優化 4: 快速操作面板

**每一列新增快速操作按鈕：**

```
[📞 撥打] [📝 備註] [👨‍🏫 分配教師] [✅ 完成]
```

**點擊後彈出對話框：**

#### 📞 撥打電話對話框
```
學生：張三
電話：0912-345-678
狀態：未開始

[ ] 已接通
[ ] 無應答
[ ] 忙線中
[ ] 號碼錯誤

備註：
[                    ]

[取消]  [儲存記錄]
```

#### 👨‍🏫 分配教師對話框
```
學生：張三
方案：8堂體驗課

選擇教師：
[ ] Elena
[ ] Karen
[ ] Vicky  (推薦：負載較低)
[ ] Orange

預約時間：
[日期選擇器]

[取消]  [確認分配]
```

---

### 優化 5: 統計卡片優化

**目前：**
```
未知教師: 27
  未開始 27
```

**改為：**
```
📋 待分配教師 (27)
  🔴 超過 7 天: 12
  🟡 3-7 天: 8
  🟢 3 天內: 7

📞 今日待撥打: 15
  未開始: 12
  體驗中: 3
```

---

### 優化 6: 篩選器增強

**新增快速篩選：**
```
[全部] [今日待辦] [高優先] [未聯繫] [已逾期]

搜尋：[姓名/Email/電話]

狀態：[未開始] [體驗中] [未轉高] [已轉高]

教師：[所有教師] [Elena] [Karen] [Vicky] [Orange] [未分配]

優先級：[全部] [高] [中] [低]

購買日期：[本週] [本月] [自訂範圍]
```

---

## 📋 資料庫需求

### 需要新增欄位

#### 1. `trial_class_purchases` 表
```sql
-- 如果沒有，需要新增
ALTER TABLE trial_class_purchases ADD COLUMN IF NOT EXISTS student_phone VARCHAR(20);
ALTER TABLE trial_class_purchases ADD COLUMN IF NOT EXISTS last_contact_date DATE;
ALTER TABLE trial_class_purchases ADD COLUMN IF NOT EXISTS contact_notes TEXT;
ALTER TABLE trial_class_purchases ADD COLUMN IF NOT EXISTS assigned_teacher VARCHAR(50);
ALTER TABLE trial_class_purchases ADD COLUMN IF NOT EXISTS priority_level VARCHAR(10); -- 'high', 'medium', 'low'
```

#### 2. 新增通話記錄表（可選）
```sql
CREATE TABLE IF NOT EXISTS telemarketing_call_logs (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  student_email VARCHAR(255) NOT NULL,
  call_date TIMESTAMP NOT NULL DEFAULT NOW(),
  call_result VARCHAR(50), -- 'connected', 'no_answer', 'busy', 'wrong_number'
  notes TEXT,
  next_action VARCHAR(100),
  next_action_date DATE,
  staff_name VARCHAR(100),
  created_at TIMESTAMP DEFAULT NOW()
);
```

---

## 🚀 實作優先級

### Phase 1: 基礎優化（1-2 小時）
- ✅ 修正「未知教師」→「未開始學生」文字
- ✅ 新增「購買日期」欄位
- ✅ 新增「電話」欄位（如果資料表有）
- ✅ 優先級排序邏輯

### Phase 2: 互動功能（2-3 小時）
- 📞 撥打電話對話框
- 📝 快速備註功能
- 👨‍🏫 分配教師功能
- 💾 儲存通話記錄

### Phase 3: 進階功能（3-4 小時）
- 📊 通話記錄管理頁面
- 📈 電話人員績效統計
- 🔔 自動提醒（超過 X 天未聯繫）
- 📤 匯出待撥打清單

---

## 💡 UI/UX 設計建議

### 顏色編碼
- 🔴 紅色：高優先（超過 7 天未聯繫）
- 🟡 黃色：中優先（3-7 天）
- 🟢 綠色：低優先（3 天內）
- ⚪ 灰色：已完成/已轉高

### 圖示使用
- 📞 電話圖示 - 撥打/聯繫
- 📝 筆記圖示 - 備註
- 👨‍🏫 人物圖示 - 教師
- ✅ 勾選圖示 - 完成
- 🔔 鈴鐺圖示 - 提醒
- ⏰ 時鐘圖示 - 時間相關

### 操作流程優化
```
1. 電話人員登入
   ↓
2. 看到「今日待辦」清單（自動篩選高優先）
   ↓
3. 點擊「撥打電話」按鈕
   ↓
4. 撥打後記錄結果 + 備註
   ↓
5. 如果是「未開始」學生 → 分配教師
   ↓
6. 系統自動移到下一個待撥打學生
```

---

## 🎯 預期效果

### 效率提升
- ⏱️ 減少 50% 查找學生時間
- 📊 提升 30% 聯繫成功率
- 📈 提高 40% 教師分配速度

### 資料追蹤
- ✅ 100% 通話記錄留存
- 📊 即時查看電話人員績效
- 🔍 快速找到逾期未聯繫學生

---

## 📝 範例畫面設計

### 優化後的學生跟進表
```
┌─────────────────────────────────────────────────────────────────────────┐
│ 📋 學生跟進狀態                                   今日待辦: 15   本週: 42 │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  [今日待辦] [高優先] [本週新增] [未聯繫] [逾期]                            │
│                                                                         │
│  搜尋: [____________________]  狀態: [未開始 ▼]  教師: [未分配 ▼]         │
│                                                                         │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  📞 待分配教師 (27)                                                      │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │  🔴 超過 7 天: 12     🟡 3-7 天: 8     🟢 3 天內: 7                 │  │
│  └───────────────────────────────────────────────────────────────────┘  │
│                                                                         │
├─────┬─────────────┬──────────┬──────────┬────────┬───────┬──────────┤
│ 🔴  │ 張三        │ 0912...  │ 10/01    │ 未開始  │ 12天前 │ [📞] [📝] │
│ 🔴  │ 李四        │ 0923...  │ 10/02    │ 未開始  │ 11天前 │ [📞] [📝] │
│ 🟡  │ 王五        │ 0934...  │ 10/08    │ 未開始  │ 5天前  │ [📞] [📝] │
│ 🟢  │ 趙六        │ 0945...  │ 10/11    │ 未開始  │ 2天前  │ [📞] [📝] │
└─────┴─────────────┴──────────┴──────────┴────────┴───────┴──────────┘
```

---

## 🤔 需要確認的問題

1. **電話號碼資料是否存在？**
   - 在哪個資料表？
   - 欄位名稱是什麼？

2. **是否需要通話記錄功能？**
   - 簡單的備註就好？
   - 還是需要完整的 CRM 系統？

3. **教師分配流程？**
   - 電話人員可以直接分配？
   - 還是需要教師確認？

4. **優先級規則？**
   - 目前建議的規則是否符合需求？
   - 需要自訂嗎？

---

**建議：先做 Phase 1 的基礎優化，測試後再決定是否需要 Phase 2/3 的進階功能。**
