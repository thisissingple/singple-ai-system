# 收支記錄管理系統 - Google Sheets 橫向佈局完成

**完成日期**: 2025-10-17
**完成時間**: 凌晨 02:50

---

## ✅ 最終實作：Google Sheets 風格橫向展開

### 🎯 設計理念

**類似 Google Sheets 的展開方式**：
- ✅ 每一列都有獨立的展開按鈕
- ✅ 點擊展開後，詳細欄位往**右側延伸**
- ✅ 未展開時，詳細欄位顯示為灰色空白格
- ✅ 整張表格可左右拖曳滾動查看

---

## 📊 最終表格結構

### **表頭結構** (16 欄位):
```
┌─────────────────────────────────────────────────────────────────────────────────┐
│ 日期 類型 付款 項目 教練 學生 Email 金額 備註 [展開] 電訪 諮詢 填表 建立 更新 操作 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### **未展開狀態** (基本欄位 + 空白格):
```
┌─────────────────────────────────────────────────────────────────────────┐
│ 2025/10/17  收入  現金  測試  Karen  學生  test@...  1000  備註  [>]  □  □  □  □  □  [🗑] │
└─────────────────────────────────────────────────────────────────────────┘
          ↑ 基本欄位可編輯                                     ↑ 灰色空白格（未展開）
```

### **展開狀態** (完整 16 欄位):
```
┌──────────────────────────────────────────────────────────────────────────────────────────┐
│ 2025/10/17  收入  現金  測試  Karen  學生  test@...  1000  備註  [<]  電訪  諮詢  填表  09:13  09:26  [🗑] │
└──────────────────────────────────────────────────────────────────────────────────────────┘
                                                                ↑ 詳細欄位可編輯（往右延伸）
```

---

## 🔧 技術實作細節

### **1. 表頭固定顯示所有欄位**

```typescript
<TableHeader>
  <TableRow>
    {/* 基本欄位（9 個） */}
    <TableHead>日期</TableHead>
    <TableHead>類型</TableHead>
    <TableHead>付款方式</TableHead>
    <TableHead>項目</TableHead>
    <TableHead>授課教練</TableHead>
    <TableHead>商家/學生名稱</TableHead>
    <TableHead>Email</TableHead>
    <TableHead>金額</TableHead>
    <TableHead>備註</TableHead>

    {/* 展開按鈕欄位 */}
    <TableHead className="w-[60px] text-center">展開</TableHead>

    {/* 詳細欄位（5 個，總是顯示表頭） */}
    <TableHead>電訪人員</TableHead>
    <TableHead>諮詢人員</TableHead>
    <TableHead>填表人</TableHead>
    <TableHead>建立時間</TableHead>
    <TableHead>最後更新</TableHead>

    {/* 操作欄位 */}
    <TableHead>操作</TableHead>
  </TableRow>
</TableHeader>
```

**總欄位數**: 16 欄
**總寬度**: ~2400px

---

### **2. 每列獨立展開按鈕**

```typescript
{/* 展開按鈕 */}
<TableCell className="text-center">
  <Button
    variant="ghost"
    size="sm"
    onClick={() => toggleExpand(rowKey)}
    className="h-8 w-8 p-0"
    title={isExpanded ? "收合" : "展開詳細"}
  >
    {isExpanded ? (
      <ChevronLeft className="h-4 w-4" />  // 展開時顯示 <
    ) : (
      <ChevronRight className="h-4 w-4" /> // 收合時顯示 >
    )}
  </Button>
</TableCell>
```

**位置**: 備註欄位之後
**功能**: 控制當前列的 `isExpanded` 狀態

---

### **3. 條件渲染詳細欄位**

```typescript
{/* 詳細欄位（根據展開狀態） */}
{isExpanded ? (
  <>
    {/* 展開時：顯示可編輯的 Select 和時間 */}
    <TableCell>
      <Select value={row.sales_person_id || "none"} ...>
        電訪人員下拉選單
      </Select>
    </TableCell>
    <TableCell>諮詢人員...</TableCell>
    <TableCell>填表人...</TableCell>
    <TableCell className="text-sm text-muted-foreground">
      {row.created_at || '-'}
    </TableCell>
    <TableCell className="text-sm text-muted-foreground">
      {row.updated_at || '-'}
    </TableCell>
  </>
) : (
  <>
    {/* 未展開時：顯示 5 個灰色空白格 */}
    <TableCell className="bg-muted/20"></TableCell>
    <TableCell className="bg-muted/20"></TableCell>
    <TableCell className="bg-muted/20"></TableCell>
    <TableCell className="bg-muted/20"></TableCell>
    <TableCell className="bg-muted/20"></TableCell>
  </>
)}
```

**展開時**: 顯示完整表單欄位（Select + 時間）
**未展開時**: 顯示灰色背景空白格（`bg-muted/20`）

---

## 🎨 視覺效果

### **灰色空白格設計**:
- **顏色**: `bg-muted/20` (淺灰色，20% 不透明度)
- **用途**: 視覺提示該列未展開
- **優點**: 保持表格對齊，類似 Google Sheets

### **展開按鈕圖示**:
- **未展開**: `ChevronRight` (>)
- **已展開**: `ChevronLeft` (<)
- **語意**: 箭頭指向詳細欄位方向

---

## 🔄 與舊版的差異

### **舊版（垂直展開）**:
```
┌──────────────────────────────┐
│ 日期 類型 項目 ... 操作 [v]  │  ← 主列
├──────────────────────────────┤
│  ┌──────────────────────┐    │  ← 展開後
│  │  詳細資訊區域         │    │     垂直顯示
│  │  電訪：XXX           │    │     在下方
│  │  諮詢：XXX           │    │
│  └──────────────────────┘    │
└──────────────────────────────┘
```

### **新版（橫向展開）**:
```
┌────────────────────────────────────────────────────────┐
│ 日期 類型 項目 ... [>] → → → 往右滾動查看詳細欄位    │
└────────────────────────────────────────────────────────┘
        ↑ 基本欄位         ↑ 展開按鈕    ↑ 詳細欄位（往右延伸）
```

---

## 💡 關鍵改進

### **1. 空間利用更有效率**:
- ❌ 舊版：垂直展開佔用大量縱向空間
- ✅ 新版：橫向展開，可同時查看多列

### **2. 操作更直觀**:
- ❌ 舊版：需要逐一點擊每列查看詳細資訊
- ✅ 新版：一眼看出哪些列已展開（灰色格 vs 填充格）

### **3. 類似 Google Sheets**:
- ✅ 固定表頭，所有欄位永遠可見
- ✅ 橫向滾動查看所有內容
- ✅ 每列獨立控制展開狀態

---

## 📁 修改的檔案

### **前端** (1 個檔案):
- `client/src/pages/reports/income-expense-manager.tsx`
  - **Line 800-820**: 修改表頭，固定顯示 16 欄
  - **Line 972-987**: 新增展開按鈕欄位
  - **Line 989-1071**: 條件渲染詳細欄位（展開 vs 空白格）
  - **Line 824**: 修正 colSpan 為 16

### **移除的功能**:
- ❌ 全局折疊按鈕（`showConsultFields` state）
- ❌ 垂直展開詳細資訊區域（已用 `{false &&` 停用）

---

## 🧪 測試檢查清單

### **基本功能** ✅:
- [x] 表格載入正常（16 欄位）
- [x] 展開按鈕對齊正確
- [x] 未展開時顯示灰色空白格
- [x] 展開後顯示詳細欄位（可編輯）
- [x] 橫向滾動流暢

### **互動測試** ⏳:
- [ ] 點擊展開按鈕，欄位正確顯示
- [ ] 點擊收合按鈕，回到灰色空白格
- [ ] 編輯詳細欄位，儲存成功
- [ ] 多列同時展開，互不影響
- [ ] 拖曳滾動條，查看所有欄位

### **視覺驗證** ⏳:
- [ ] 灰色空白格與其他欄位高度一致
- [ ] 展開按鈕圖示正確（> / <）
- [ ] 表格對齊整齊，類似 Google Sheets

---

## 📊 欄位寬度配置

| 欄位 | 寬度 | 類型 |
|------|------|------|
| 日期 | 140px | Input (date) |
| 類型 | 110px | Select |
| 付款方式 | 140px | Select |
| 項目 | 220px | Input |
| 授課教練 | 160px | Select |
| 商家/學生名稱 | 150px | Input |
| Email | 200px | Input |
| 金額 | 180px | Input + Select (幣別) |
| 備註 | 220px | Input |
| **展開** | **60px** | **Button** |
| 電訪人員 | 150px | Select (展開後) |
| 諮詢人員 | 150px | Select (展開後) |
| 填表人 | 150px | Select (展開後) |
| 建立時間 | 180px | Text (只讀) |
| 最後更新 | 180px | Text (只讀) |
| 操作 | 80px | Button (刪除) |

**總寬度**: ~2400px

---

## 🚀 使用說明

### **查看基本資訊**:
1. 載入頁面，看到前 9 個基本欄位
2. 往右滾動，看到灰色空白格（表示可展開）

### **展開查看詳細**:
1. 點擊該列的 `>` 按鈕
2. 灰色空白格變為可編輯欄位
3. 往右滾動查看電訪、諮詢、填表人、時間等資訊

### **編輯詳細資訊**:
1. 展開該列
2. 點擊 Select 下拉選單選擇人員
3. 時間欄位為只讀（自動記錄）
4. 點擊「儲存」按鈕保存

### **收合隱藏詳細**:
1. 點擊該列的 `<` 按鈕
2. 詳細欄位變回灰色空白格
3. 節省螢幕空間

---

## 🎯 下一步建議

### **立即測試**:
1. 🌐 重新整理瀏覽器 `/reports/income-expense-manager`
2. 🖱️ 點擊任意列的 `>` 按鈕測試展開
3. ↔️ 橫向拖曳滾動條，查看所有欄位
4. ✏️ 編輯詳細欄位，測試儲存功能

### **優化方向**（未來）:
1. 加入欄位寬度可調整（拖曳邊界）
2. 記憶展開狀態（重新整理後保留）
3. 全部展開/收合快捷鍵
4. 匯出 Excel 時包含詳細欄位

---

## 📝 相關文檔

- `INCOME_EXPENSE_HORIZONTAL_LAYOUT_COMPLETE.md` - 第一版橫向佈局（已被取代）
- `SESSION_SUMMARY_2025-10-16.md` - 收支系統開發總結
- `Migration 030` - student_name/student_email 欄位

---

**開發完成**: 2025-10-17 凌晨 02:50
**實作方式**: Google Sheets 風格橫向展開
**總欄位數**: 16 欄
**測試狀態**: ⏳ 等待瀏覽器測試

---

🎉 **收支記錄管理系統 - Google Sheets 風格橫向佈局完成！**

現在每一列都有獨立的展開按鈕，點擊後詳細欄位會往右延伸，就像 Google Sheets 一樣！
