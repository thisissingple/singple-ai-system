# 收支記錄表 - 付款方式移至主表格

**日期**: 2025-10-16
**狀態**: ✅ 完成

---

## 🎯 更新目標

將「付款方式」從詳細資訊區移至主表格，放在「類型」後面，方便快速選擇。

---

## ✅ 完成的修改

### 1. 表格欄位調整

**新的欄位順序**（10 欄）：
```
1. 日期
2. 類型
3. 付款方式        ⭐ 新增到主表格
4. 項目
5. 授課教練
6. 商家/學生名稱
7. Email
8. 金額
9. 備註
10. 操作
```

**變更前**（9 欄）：
```
日期 → 類型 → 項目 → 教練 → 客戶 → Email → 金額 → 備註 → 操作
```

**變更後**（10 欄）：
```
日期 → 類型 → 付款方式 → 項目 → 教練 → 客戶 → Email → 金額 → 備註 → 操作
              ↑ 新增
```

---

### 2. 詳細資訊區簡化

**移除前**：
```
詳細資訊
├─ 業務資訊
│  └─ 💼 付款方式
├─ 人員資訊
│  ├─ 📞 電訪人員
│  ├─ 🎯 諮詢人員
│  └─ ✍️ 填表人
└─ 時間資訊
   └─ 🕑 最後更新
```

**移除後**（更簡潔）：
```
詳細資訊
├─ 人員資訊
│  ├─ 📞 電訪人員
│  ├─ 🎯 諮詢人員
│  └─ ✍️ 填表人
└─ 時間資訊
   └─ 🕑 最後更新
```

---

## 📋 付款方式欄位設計

### **下拉選單樣式**
```tsx
<Select
  value={row.payment_method || "none"}
  onValueChange={(value) => handleUpdateRow(index, 'payment_method', value === "none" ? "" : value)}
>
  <SelectTrigger className="h-9">
    <SelectValue placeholder="選擇" />
  </SelectTrigger>
  <SelectContent>
    <SelectItem value="none">未選擇</SelectItem>
    {paymentMethods.map((method) => (
      <SelectItem key={method} value={method}>
        {method}
      </SelectItem>
    ))}
  </SelectContent>
</Select>
```

### **欄位寬度**
- 寬度：`140px`
- 與「類型」欄位同樣大小
- 適合顯示中文付款方式名稱

---

## 🎨 視覺效果

### **主表格**
```
┌──────────────────────────────────────────────────────────┐
│ 日期 │ 類型 │ 付款方式 │ 項目 │ 教練 │ 客戶 │ 金額 │ ... │
├──────────────────────────────────────────────────────────┤
│ 10/16│ 收入 │ 信用卡▼ │ 課程 │ ... │ ... │ 5000 │ ... │
│ 10/15│ 支出 │ 匯款▼   │ 租金 │ ... │ ... │ 3000 │ ... │
│ 10/14│ 收入 │ 現金▼   │ 書籍 │ ... │ ... │ 500  │ ... │
└──────────────────────────────────────────────────────────┘
```

---

## 🔄 資料流

### **儲存邏輯**（無需修改）
```typescript
const payload = {
  // ... 其他欄位
  payment_method: row.payment_method?.trim() || null,
};
```

### **顯示邏輯**
```typescript
// 主表格
value={row.payment_method || "none"}

// 未選擇 = 空字串（儲存為 null）
// 已選擇 = 付款方式名稱（例如：「信用卡」）
```

---

## 💡 設計優點

### **1. 提高效率** ⚡
- ✅ 無需展開詳細資訊即可選擇付款方式
- ✅ 快速填寫常用欄位
- ✅ 減少點擊次數

### **2. 視覺清晰** 👁️
- ✅ 重要資訊一目了然
- ✅ 付款方式與類型相鄰，邏輯相關
- ✅ 表格寬度增加可接受（1600px → 1740px）

### **3. 保持靈活** 🔧
- ✅ 仍可透過「選項設定」自訂付款方式
- ✅ 詳細資訊區保留其他進階欄位
- ✅ 資料結構完全相容

---

## 📊 欄位優先級對比

### **主表格欄位**（高優先級）
```
✅ 日期            - 必填
✅ 類型            - 必填（收入/支出/退款）
✅ 付款方式        - 常用（新增到主表格）⭐
✅ 項目            - 必填
✅ 授課教練        - 常用
✅ 商家/學生名稱   - 常用
✅ Email           - 常用
✅ 金額            - 必填
✅ 備註            - 常用
```

### **詳細資訊欄位**（低優先級）
```
📋 電訪人員        - 選填
📋 諮詢人員        - 選填
📋 填表人          - 選填
📋 最後更新        - 系統自動
📋 匯率資訊        - 系統自動（外幣時）
```

---

## 🧪 測試項目

- [ ] 主表格顯示「付款方式」欄位
- [ ] 付款方式下拉選單包含 9 種選項
- [ ] 選擇「未選擇」儲存為空值
- [ ] 選擇付款方式後正確儲存
- [ ] 重新載入後付款方式正確顯示
- [ ] 詳細資訊區不再顯示付款方式
- [ ] 表格寬度正常（可水平滾動）

---

## 📂 修改的檔案

**前端**：
- `client/src/pages/reports/income-expense-manager.tsx`
  - 表格標題新增「付款方式」欄位
  - 表格內容新增付款方式下拉選單
  - 更新 colspan（9 → 10）
  - 移除詳細資訊區的付款方式欄位
  - 移除「業務資訊」區塊（已無內容）

---

## 🎯 最終效果

### **填寫流程簡化**

**變更前**：
1. 填寫主表格（日期、類型、項目等）
2. 展開詳細資訊
3. 選擇付款方式
4. 儲存

**變更後**：
1. 填寫主表格（日期、類型、**付款方式**、項目等）✅ 一步完成
2. 儲存

### **資訊密度**
- 主表格：10 欄（+1）
- 詳細資訊：4 欄（-1）
- 總欄位數：14 欄（不變）

---

**完成時間**: 2025-10-16 下午
**修改行數**: ~50 行
**測試狀態**: ⏳ 待瀏覽器驗證
