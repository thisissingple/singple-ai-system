# AI Instructions 整合完成

> **完成日期**: 2025-10-13
> **更新**: 銷售分析 GPT 指令已整合到教學品質追蹤系統

---

## ✅ 已完成的更新

### 1. **後端服務更新** (teaching-quality-gpt-service.ts)

#### 更新的 System Prompt
```typescript
const CONVERSION_OPTIMIZATION_PROMPT = `你是一個專業的「諮詢銷售分析教練」。
我會提供你我跟學員的完整對話紀錄，請你根據以下步驟，輸出一份完整的分析報告：

### 學員狀況分析
1. 技術面問題：歌唱上的具體痛點
2. 心理面問題：自信、比較、尷尬等
3. 動機來源：為什麼現在想學、觸發點
4. 學員屬性：年齡層/是否自己付費/對價值的敏感度

### 成交策略
1. 痛點放大：如何承接學員的痛點並正常化
2. 夢想畫面：如何描述學員想要的未來場景
3. 產品匹配：適合推薦哪種類型的課程
4. 話術設計：可直接在通話中使用的具體話術
5. 成交收斂：最後收斂成交的語句

### 輸出原則
- 用口語、親切、實戰能直接套用的文字
- 不要給籠統的建議，要給可複製的話術
- 條列清晰，方便一眼就能抓到重點
- 最後必須提供一段「完整的成交話術」作為總結
`;
```

#### 新的資料結構
```typescript
export interface StudentAnalysis {
  technicalIssues: string[];       // 技術面問題（歌唱痛點）
  psychologicalIssues: string[];   // 心理面問題（自信、比較等）
  motivationSource: string;        // 動機來源
  studentProfile: string;          // 學員屬性
}

export interface SalesStrategy {
  painPointAmplification: string;  // 痛點放大
  dreamVision: string;             // 夢想畫面
  productMatch: string;            // 產品匹配
  scriptDesign: string[];          // 話術設計（可複製的多個話術）
  closingScript: string;           // 成交收斂
}

export interface ConversionSuggestion {
  studentAnalysis: StudentAnalysis;    // 學員狀況分析
  salesStrategy: SalesStrategy;        // 成交策略
  finalClosingScript: string;          // 完整成交話術
  conversionProbability: number;       // 轉換機率 (0-100)
}
```

---

### 2. **前端顯示更新** (teaching-quality-detail.tsx)

#### 新的轉換優化分析頁面結構

**銷售分析總覽**
- 顯示轉換機率徽章

**學員狀況分析** 🎯
- 技術面問題（列表形式，紅色標題）
- 心理面問題（列表形式，橙色標題）
- 動機來源（段落形式，藍色標題）
- 學員屬性（段落形式，紫色標題）

**成交策略** 🧠
- 痛點放大
- 夢想畫面
- 產品匹配
- 話術設計（多個話術，藍色卡片展示）
- 成交收斂（綠色卡片展示）

**完整成交話術** ✨
- 特別突出顯示（綠色邊框卡片）
- 漸層背景
- 支援多行文字，保留換行格式

---

### 3. **API 更新**

#### 轉換優化 API
```typescript
POST /api/teaching-quality/analyses/:id/conversion-optimization

Request Body:
{
  "studentBackground": "選填：學員背景資訊"
}

Response:
{
  "success": true,
  "data": {
    "studentAnalysis": {
      "technicalIssues": ["問題1", "問題2"],
      "psychologicalIssues": ["問題1", "問題2"],
      "motivationSource": "...",
      "studentProfile": "..."
    },
    "salesStrategy": {
      "painPointAmplification": "...",
      "dreamVision": "...",
      "productMatch": "...",
      "scriptDesign": ["話術1", "話術2", "話術3"],
      "closingScript": "..."
    },
    "finalClosingScript": "完整成交話術...",
    "conversionProbability": 75
  }
}
```

---

## 🎯 使用場景

### 適用情況
這個 AI 銷售分析適合用於：
- **未成交的體驗課**（`conversion_status = 'not_converted'`）
- 需要分析學員為什麼沒有購買
- 需要制定後續跟進策略
- 需要優化銷售話術

### 使用流程

1. **觸發分析**
   - 在分析詳情頁面，點擊「轉換優化」分頁
   - 如果尚未生成，點擊「生成轉換優化建議」按鈕
   - （選填）提供學員背景資訊

2. **查看分析結果**
   - **學員狀況分析**：了解學員的技術和心理問題
   - **成交策略**：獲得具體的銷售策略和話術
   - **完整成交話術**：複製整合好的話術，直接使用

3. **應用話術**
   - 複製「話術設計」中的具體話術
   - 參考「完整成交話術」進行跟進通話
   - 根據「產品匹配」推薦合適的課程

---

## 💡 AI 分析特色

### 1. **實戰導向**
- 所有建議都是「可複製」的話術
- 不是籠統的建議（如「要更熱情」），而是具體的話術（如「我完全理解你的考量...」）

### 2. **結構化輸出**
- 分析結構清晰：問題 → 策略 → 話術
- 每個部分都有明確的目標和執行方式

### 3. **心理洞察**
- 不只分析技術面（歌唱問題）
- 更深入心理面（自信、比較、尷尬等）
- 找出真正的動機來源

### 4. **話術設計**
- 提供 3-5 個可直接使用的話術
- 每個話術都針對不同的痛點
- 最後整合成完整的成交話術

---

## 📊 輸出格式範例

### 學員狀況分析範例
```
技術面問題：
- 唱歌時音準不穩，尤其高音容易破音
- 換氣技巧不足，長句子會唱不完
- 缺乏舞台表演經驗，不知道如何與觀眾互動

心理面問題：
- 缺乏自信，害怕在朋友面前唱歌
- 會和專業歌手比較，覺得自己永遠達不到
- 擔心花錢學了也沒效果

動機來源：
朋友邀請參加 KTV 聚會，但因為不敢唱而覺得尷尬。希望能在下次聚會時表現得更好。

學員屬性：
25-30 歲上班族，自己付費，對價值有一定敏感度，希望看到明確的進步。
```

### 成交策略範例
```
痛點放大：
「你知道嗎？很多人都有這種經歷——在 KTV 時不敢拿麥克風，或者唱了之後覺得很尷尬。其實這完全正常，因為我們從小沒有受過專業訓練。但好消息是，這些問題都是可以改善的！」

夢想畫面：
「想像一下，下次朋友聚會時，你拿起麥克風，輕鬆唱完一首歌，大家都為你鼓掌。你會覺得很有成就感，對嗎？而且這不是遙不可及的夢想，通過系統的訓練，3-6 個月就能達到。」

產品匹配：
建議推薦「初學完整系統課程」（20-30 堂），因為學員需要從基礎開始建立信心和技巧。

話術設計：
1. 「我完全理解你的擔心。很多學員一開始也覺得自己『沒有天賦』，但其實唱歌80%靠技巧，20%靠天賦。」
2. 「你說你害怕高音破音，這是因為沒有用對方法。我們的課程會教你正確的共鳴位置和呼吸方式，通常3-5堂課就能看到明顯進步。」
3. 「關於預算的考量，我們有分期付款方案。平均一堂課不到500元，相當於一頓飯的價格，但你得到的是一輩子的技能。」

成交收斂：
「那我們這樣，我先幫你安排一個完整的評估，確定你的學習目標和課程規劃。如果你覺得合適，我們就開始第一堂課。怎麼樣？」
```

### 完整成交話術範例
```
「嗨 [學員名字]，謝謝你今天來上體驗課！我注意到你在唱歌時其實很有感覺，只是在高音和換氣部分需要一些技巧上的調整。

你剛才提到你想在朋友聚會時能自信地唱歌，對吧？我完全理解這種感受。其實很多人都有類似的經歷——不敢拿麥克風，或者唱了之後覺得尷尬。但好消息是，這些問題通過系統的訓練都是可以改善的。

想像一下，3-6 個月後，你拿起麥克風，輕鬆唱完一首歌，大家都為你鼓掌。這不是遙不可及的夢想，而是可以實現的目標。

關於你擔心的音準和換氣問題，我們的課程會從基礎開始，教你正確的呼吸方式和共鳴位置。通常3-5堂課就能看到明顯進步。

至於預算的考量，我們有分期付款方案，平均一堂課不到500元，相當於一頓飯的價格。而你得到的，是一輩子的技能和自信。

那我們這樣，我先幫你安排一個完整的課程規劃，確定你的學習目標和進度安排。如果你覺得合適，我們就馬上開始。怎麼樣？」
```

---

## 🔄 與原系統的整合

### 資料流程
```
1. 教師上完體驗課
   ↓
2. 系統記錄對話（WEBVTT 格式）
   ↓
3. 觸發 AI 教學品質分析（Phase 16.1）
   - 評分、優缺點、建議
   ↓
4. 如果學員未成交
   ↓
5. 觸發 AI 銷售分析（本次更新）
   - 學員狀況分析
   - 成交策略
   - 完整成交話術
   ↓
6. 諮詢師/教師查看分析結果
   ↓
7. 使用話術進行後續跟進
```

### 權限控制
- 教師只能看自己的分析
- 諮詢師只能看自己負責的學員
- 管理員可以看所有分析

---

## 📝 後續優化建議

### 短期（Phase 16.2）
1. 新增「生成轉換優化」按鈕
2. 加入載入動畫和進度顯示
3. 支援重新生成分析
4. 加入話術複製功能（一鍵複製）

### 中期（Phase 16.3）
1. 話術庫功能
   - 儲存成功的話術
   - 分類和標籤
   - 團隊共享

2. 跟進記錄
   - 記錄使用了哪些話術
   - 記錄學員的反應
   - 追蹤轉換進度

3. 效果追蹤
   - 統計哪些話術轉換率最高
   - 分析哪種學員類型最容易成交
   - 優化 AI 分析模型

### 長期（Phase 16.4）
1. 個人化話術生成
   - 根據諮詢師的風格調整話術
   - 學習成功案例
   - 自動優化建議

2. 即時輔助
   - 通話中即時提供話術建議
   - 根據對話內容動態調整策略

---

## 🎉 總結

您的 AI Instructions 已完全整合到系統中！

### 主要改變
- ✅ 後端 System Prompt 更新
- ✅ 資料結構完全重構
- ✅ 前端顯示全新設計
- ✅ API 回應格式更新

### 立即可用
- Port 5000 已關閉
- 所有代碼已更新
- 型別定義已同步
- 前端 UI 已優化

### 下次測試時
1. 啟動開發伺服器：`npm run dev`
2. 訪問教學品質分析頁面
3. 選擇未成交的分析記錄
4. 點擊「轉換優化」分頁
5. 查看完整的銷售分析結果

---

**整合完成時間**: 2025-10-13
**狀態**: ✅ 完全整合，等待測試
