# Debug ç¸½çµå ±å‘Š (2025-10-13 07:06)

## ğŸ› é‡åˆ°çš„å•é¡Œ

### å•é¡Œï¼šPort 5000 è¢«ä½”ç”¨
**éŒ¯èª¤è¨Šæ¯**ï¼š
```
Error: listen EADDRINUSE: address already in use 0.0.0.0:5000
```

**åŸå› **ï¼š
- ä¹‹å‰å•Ÿå‹•äº†å…©å€‹èƒŒæ™¯é€²ç¨‹ï¼ˆ44cfbf å’Œ f3ff73ï¼‰
- ç¬¬ä¸€å€‹é€²ç¨‹å·²ç¶“ä½”ç”¨äº† 5000 ç«¯å£
- ç¬¬äºŒå€‹é€²ç¨‹å˜—è©¦å•Ÿå‹•æ™‚ç™¼ç”Ÿè¡çª

---

## âœ… è§£æ±ºæ–¹æ¡ˆ

### 1. çµ‚æ­¢èƒŒæ™¯é€²ç¨‹
```bash
# å˜—è©¦çµ‚æ­¢é€²ç¨‹
pkill -f 'tsx server/index.ts'

# çµ‚æ­¢ç‰¹å®šçš„èƒŒæ™¯ shell
KillShell 44cfbf
KillShell f3ff73
```

### 2. é‡æ–°å•Ÿå‹•ä¼ºæœå™¨
```bash
npm run dev
```

**çµæœ**ï¼š
```
ğŸš€ Server running on port 5000
```

---

## ğŸ§ª API æ¸¬è©¦çµæœ

### æ¸¬è©¦ 1: åˆ—å‡ºæ‰€æœ‰è³‡æ–™è¡¨ âœ…
**ç«¯é»**ï¼š`GET /api/database/tables`

**å›æ‡‰**ï¼š
```json
{
  "tables": [
    "custom_forms",
    "eods_for_closers",
    "form_submissions",
    "trial_class_attendance",
    "trial_class_purchases",
    "users"
  ]
}
```

âœ… **ç‹€æ…‹**ï¼šæ­£å¸¸

---

### æ¸¬è©¦ 2: æŸ¥è©¢ users è¡¨æ ¼æ¬„ä½ âœ…
**ç«¯é»**ï¼š`GET /api/database/tables/users/columns`

**å›æ‡‰æ¬„ä½**ï¼ˆéƒ¨åˆ†ï¼‰ï¼š
```json
{
  "columns": [
    {
      "column_name": "id",
      "data_type": "uuid",
      "is_nullable": "NO",
      "column_default": "uuid_generate_v4()"
    },
    {
      "column_name": "email",
      "data_type": "character varying",
      "is_nullable": "YES",
      "column_default": null
    },
    {
      "column_name": "roles",
      "data_type": "ARRAY",
      "is_nullable": "YES",
      "column_default": "ARRAY[]::text[]"
    }
  ]
}
```

âœ… **ç‹€æ…‹**ï¼šæ­£å¸¸

---

## ğŸ¯ ç³»çµ±ç‹€æ…‹

### ä¼ºæœå™¨
- **ç‹€æ…‹**ï¼šâœ… Running
- **Port**ï¼š5000
- **ç’°å¢ƒ**ï¼šdevelopment
- **èªè­‰**ï¼šSKIP_AUTH (é–‹ç™¼æ¨¡å¼)
- **Session Store**ï¼šMemory (é–‹ç™¼æ¨¡å¼)

### è³‡æ–™åº«é€£ç·š
- **é¡å‹**ï¼šPostgreSQL (Supabase)
- **é€£ç·šæ–¹å¼**ï¼šDirect connection via `pg` module
- **ç‹€æ…‹**ï¼šâœ… Connected

### èƒŒæ™¯é€²ç¨‹
- **44cfbf**ï¼šâŒ Terminated (åŸ dev:clean)
- **f3ff73**ï¼šâŒ Terminated (åŸ dev)
- **05b9c4**ï¼šâœ… Running (ç•¶å‰ dev server)

---

## ğŸ“Š åŠŸèƒ½é©—è­‰

### 1. è³‡æ–™åº«ç€è¦½å™¨ API âœ…
- âœ… GET /api/database/tables - åˆ—å‡ºæ‰€æœ‰è¡¨æ ¼
- âœ… GET /api/database/tables/:tableName/columns - æŸ¥è©¢æ¬„ä½
- â³ GET /api/database/:tableName/data - æŸ¥è©¢è³‡æ–™ï¼ˆå¾…å‰ç«¯æ¸¬è©¦ï¼‰
- â³ PUT /api/database/:tableName/:id - æ›´æ–°è³‡æ–™ï¼ˆå¾…å‰ç«¯æ¸¬è©¦ï¼‰
- â³ DELETE /api/database/:tableName/:id - åˆªé™¤è³‡æ–™ï¼ˆå¾…å‰ç«¯æ¸¬è©¦ï¼‰

### 2. KPI åŠŸèƒ½ â³
- â³ Tooltip é¡¯ç¤ºï¼ˆå¾…å‰ç«¯æ¸¬è©¦ï¼‰
- â³ å®šç¾©å°è©±æ¡†ï¼ˆå¾…å‰ç«¯æ¸¬è©¦ï¼‰
- â³ æ”¶ç›Šè¨ˆç®—ä¿®æ­£ï¼ˆå¾…å‰ç«¯æ¸¬è©¦ï¼‰

### 3. å­¸ç”Ÿè·Ÿé€²è¡¨ â³
- â³ ç‹€æ…‹ç¯©é¸ï¼ˆå¾…å‰ç«¯æ¸¬è©¦ï¼‰
- â³ æ•™å¸«ç¯©é¸ï¼ˆå¾…å‰ç«¯æ¸¬è©¦ï¼‰
- â³ æ—¥æœŸç¯©é¸ï¼ˆå¾…å‰ç«¯æ¸¬è©¦ï¼‰
- â³ è€å¸«è¡Œå‹•è¿½è¹¤ï¼ˆå¾…å‰ç«¯æ¸¬è©¦ï¼‰

---

## ğŸ”§ Debug æŠ€å·§ç¸½çµ

### 1. æª¢æŸ¥ç«¯å£ä½”ç”¨
```bash
# ä½¿ç”¨ lsofï¼ˆå¦‚æœå¯ç”¨ï¼‰
lsof -i :5000

# ä½¿ç”¨ netstat æˆ– ss
netstat -tulpn | grep :5000
ss -tulpn | grep :5000

# æª¢æŸ¥é€²ç¨‹
ps aux | grep tsx
```

### 2. çµ‚æ­¢é€²ç¨‹
```bash
# æ–¹æ³• 1: ç›´æ¥ kill
pkill -f 'tsx server/index.ts'

# æ–¹æ³• 2: ä½¿ç”¨ npm script
npm run dev:clean

# æ–¹æ³• 3: ä½¿ç”¨ KillShell tool
KillShell <shell_id>
```

### 3. æ¸¬è©¦ API
```bash
# ç°¡å–®æ¸¬è©¦
curl http://localhost:5000/api/database/tables

# æ ¼å¼åŒ– JSONï¼ˆå¦‚æœæœ‰ python3ï¼‰
curl -s URL | python3 -m json.tool

# åªé¡¯ç¤ºå‰ N å€‹å­—å…ƒ
curl -s URL | head -c 200
```

---

## ğŸ’¡ å­¸ç¿’è¦é»

### 1. èƒŒæ™¯é€²ç¨‹ç®¡ç†
- ä½¿ç”¨ `run_in_background: true` æ™‚è¦è¨˜å¾—è¿½è¹¤ shell_id
- å•Ÿå‹•æ–°é€²ç¨‹å‰æ‡‰è©²å…ˆæª¢æŸ¥ç«¯å£æ˜¯å¦è¢«ä½”ç”¨
- ä½¿ç”¨ `BashOutput` å·¥å…·ç›£æ§èƒŒæ™¯é€²ç¨‹ç‹€æ…‹

### 2. ç«¯å£è¡çªè™•ç†
- EADDRINUSE éŒ¯èª¤è¡¨ç¤ºç«¯å£å·²è¢«ä½”ç”¨
- æ‡‰è©²å…ˆçµ‚æ­¢èˆŠé€²ç¨‹å†å•Ÿå‹•æ–°é€²ç¨‹
- é–‹ç™¼ç’°å¢ƒå¯ä»¥ä½¿ç”¨ `dev:clean` script è‡ªå‹•æ¸…ç†

### 3. API æ¸¬è©¦æµç¨‹
1. ç¢ºèªä¼ºæœå™¨å•Ÿå‹•æˆåŠŸ
2. æ¸¬è©¦ç°¡å–®çš„ GET ç«¯é»
3. é©—è­‰å›æ‡‰æ ¼å¼æ­£ç¢º
4. å‰ç«¯æ¸¬è©¦è¤‡é›œçš„ CRUD æ“ä½œ

---

## ğŸš€ ä¸‹ä¸€æ­¥è¡Œå‹•

### ç«‹å³è¡Œå‹•
1. âœ… ä¼ºæœå™¨å·²å•Ÿå‹•ä¸¦é‹è¡Œæ­£å¸¸
2. âœ… API ç«¯é»é©—è­‰å®Œæˆï¼ˆåŸºæœ¬æ¸¬è©¦ï¼‰
3. â³ å‰å¾€å‰ç«¯æ¸¬è©¦æ–°åŠŸèƒ½

### å‰ç«¯æ¸¬è©¦æ¸…å–®
- [ ] æ‰“é–‹ç€è¦½å™¨è¨ªå• http://localhost:5000
- [ ] æ¸¬è©¦é«”é©—èª²å ±å‘Šé é¢çš„ KPI Tooltips
- [ ] æ¸¬è©¦å­¸ç”Ÿè·Ÿé€²è¡¨çš„ç¯©é¸åŠŸèƒ½
- [ ] æ¸¬è©¦è³‡æ–™åº«ç€è¦½å™¨å·¥å…·ï¼ˆå·¥å…·é¸å–®ï¼‰
- [ ] æ¸¬è©¦è³‡æ–™åº«ç€è¦½å™¨çš„ç·¨è¼¯å’Œåˆªé™¤åŠŸèƒ½

### æ½›åœ¨æ”¹é€²
1. åŠ å…¥å¥åº·æª¢æŸ¥ç«¯é»ï¼ˆGET /healthï¼‰
2. åŠ å…¥ API éŒ¯èª¤è™•ç†ä¸­é–“ä»¶
3. åŠ å…¥è«‹æ±‚æ—¥èªŒè¨˜éŒ„
4. è€ƒæ…®ä½¿ç”¨ PM2 ç®¡ç†é€²ç¨‹

---

**Debug å®Œæˆæ™‚é–“**ï¼š2025-10-13 07:06
**ç‹€æ…‹**ï¼šâœ… å·²è§£æ±ºï¼Œä¼ºæœå™¨æ­£å¸¸é‹è¡Œ
**ç•¶å‰ä¼ºæœå™¨é€²ç¨‹**ï¼š05b9c4 (npm run dev)
